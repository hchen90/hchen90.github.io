(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[649],{853:e=>{e.exports={tiledBackgroundContainer:"TiledBackground_tiledBackgroundContainer__Lm2En",tiledBackground:"TiledBackground_tiledBackground__wV_tn",loading:"TiledBackground_loading__K5f9_",error:"TiledBackground_error__P8Erq",progressOverlay:"TiledBackground_progressOverlay__4HU6_",progressBar:"TiledBackground_progressBar__qk0iG",progressFill:"TiledBackground_progressFill__pG2uJ",progressText:"TiledBackground_progressText__A3ga4"}},3649:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var o=t(5155),a=t(2115),n=t(853),l=t.n(n);function c(){let[e,r]=(0,a.useState)(!0),[t,n]=(0,a.useState)(null),[c,i]=(0,a.useState)(null),d=(0,a.useRef)(null);return((0,a.useEffect)(()=>{(async()=>{try{r(!0);let e=await fetch("/api/v1/background/tiles"),t=await e.json();if(0!==t.code){n("Failed to load background metadata"),r(!1);return}let{id:o,rows:a,cols:l,width:c,height:s}=t.data,g=l*c,u=a*s,_=[];for(let e=0;e<a;e++)for(let r=0;r<l;r++)_.push({x:r,y:e,width:c,height:s}),console.log("Tile created: ".concat(r,"-").concat(e));i({originalWidth:g,originalHeight:u,cols:l,rows:a,width:c,height:s});let h={};for(let e=0;e<a;e++)for(let r=0;r<l;r++){let t="".concat(r,"-").concat(e),a=((e,r)=>{let o=new Image;return o.onload=()=>{if(d.current){let t=d.current.getContext("2d");t&&(console.log("Tile loaded: ".concat(e,"-").concat(r)),t.drawImage(o,e*c,r*s))}h[t]=!0},o})(r,e);fetch("/api/v1/background/tiles/".concat(r,"/").concat(e),{headers:{"X-Image-Id":o}}).then(e=>e.blob()).then(e=>{a.src=URL.createObjectURL(e)}).catch(t=>{console.error("Failed to load tile ".concat(r,"-").concat(e,":"),t),"function"==typeof a.onerror&&a.onerror(new Event("error"))})}r(!1)}catch(e){console.error("Error loading background tiles:",e),n(e instanceof Error?e.message:"Failed to load background tiles"),r(!1)}})()},[]),(0,a.useEffect)(()=>{if(!c||!d.current)return;let e=d.current,r=e.getContext("2d");r&&(e.width=c.originalWidth,e.height=c.originalHeight,r.fillStyle="#6B7280",r.fillRect(0,0,e.width,e.height))},[c]),t)?(0,o.jsxs)("div",{className:l().error,children:["Error loading background: ",t]}):(0,o.jsx)("div",{className:l().tiledBackgroundContainer,children:e||!c?(0,o.jsx)("div",{style:{display:"none"}}):(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("canvas",{ref:d,className:l().tiledBackground,width:c.originalWidth,height:c.originalHeight})})})}}}]);