(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},415:(e,t,s)=>{"use strict";s.d(t,{default:()=>g});var a=s(5155),r=s(2115),l=s(1778),o=s(9843),i=s(9298),n=s(6606),d=s(4548);function c(e){let{message:t}=e,[s,c]=(0,r.useState)(""),[h,x]=(0,r.useState)(!1),u=(0,l.m)(t.timestamp,{addSuffix:!0,locale:o.g}),w=e=>[/#{1,6}\s+/,/\*\*.*\*\*/,/\*.*\*/,/`.*`/,/```[\s\S]*```/,/\[.*\]\(.*\)/,/^\s*[\*\-\+]\s+/m,/^\s*\d+\.\s+/m,/^\s*>\s+/m].some(t=>t.test(e));(0,r.useEffect)(()=>{(async()=>{let e=t.content,s=w(e);if(x(s),s)try{let t=await (0,i.V)().use(n.A).use(d.A).process(e);c(String(t))}catch(t){console.error("Error processing markdown:",t),c(e)}else c(e)})()},[t.content]);let m="bot"===t.role;return(0,a.jsxs)("div",{className:"mb-4 ".concat(m?"self-start":"self-end text-right"," message-animation"),style:{maxWidth:"100%"},children:[(0,a.jsx)("div",{className:"flex ".concat(m?"justify-start":"justify-end"," w-full"),style:{maxWidth:"100%"},children:(0,a.jsx)("div",{className:"p-3 rounded-lg chatra-bubble ".concat(m?"bg-gray-200 text-gray-800 rounded-tl-none":"bg-blue-600 text-white rounded-tr-none"," max-w-[80%] break-words"),style:{maxWidth:"280px",overflowWrap:"break-word",wordWrap:"break-word",wordBreak:"break-word"},children:h?(0,a.jsx)("div",{className:"markdown-content-chatbot",dangerouslySetInnerHTML:{__html:s}}):(0,a.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:s})})}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1 ".concat(m?"text-left":"text-right"),children:u})]})}function h(e){let{onSendMessage:t}=e,[s,l]=(0,r.useState)(""),o=()=>{s.trim()&&(t(s),l(""))};return(0,a.jsxs)("div",{className:"border-t border-gray-200 p-3 bg-white w-full",style:{maxWidth:"100%",overflowX:"hidden",width:"384px"},children:[(0,a.jsxs)("div",{className:"flex items-end gap-2 w-full",style:{maxWidth:"100%"},children:[(0,a.jsx)("textarea",{className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"输入您的问题...",value:s,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o())},rows:2,style:{maxWidth:"calc(100% - 70px)",overflowWrap:"break-word",wordWrap:"break-word",wordBreak:"break-word"}}),(0,a.jsx)("button",{onClick:o,disabled:!s.trim(),className:"bg-blue-600 text-white rounded-lg px-4 py-2 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"发送"})]}),(0,a.jsx)("div",{className:"mt-2 text-xs text-gray-500 text-center",children:(0,a.jsx)("p",{children:"按Enter键发送，Shift+Enter键换行"})})]})}var x=s(6408),u=s(760),w=s(6766);s(3523);let m={id:"welcome",content:"欢迎来到HCHEN90博客! 我是AI助手，有什么可以帮助您的吗？",role:"bot",timestamp:new Date};function g(){let[e,t]=(0,r.useState)(!1),[s,l]=(0,r.useState)(!1),[o,i]=(0,r.useState)([m]),[n,d]=(0,r.useState)(!1),[g,f]=(0,r.useState)(""),p=(0,r.useRef)(null),b=()=>{if(e){let e=window.location.pathname.split("/");if(e.includes("post")){let t=e.indexOf("post")+1;if(t<e.length)return e[t]}}return""},v=async()=>{try{let e=await fetch("/api/v1/llm/session");if(!e.ok)throw Error("Network response was not ok");return(await e.json()).data.session_id||""}catch(e){return console.error("获取会话ID失败:",e),""}};if((0,r.useEffect)(()=>{t(!0),(async()=>{let e=await v();e&&(console.log("会话ID: ".concat(e)),f(e))})()},[]),(0,r.useEffect)(()=>{p.current&&p.current.scrollIntoView({behavior:"smooth"})},[o]),!e)return null;let y=async()=>{try{let e=await v();e&&(console.log("新会话ID: ".concat(e)),f(e),i([m]),console.log("会话已重置"))}catch(e){console.error("重置会话失败:",e)}},j=async e=>{if(!e.trim())return;let t=Date.now().toString(),s=b();console.log("Session ID: ".concat(g)),console.log("Current Post ID: ".concat(s));let a={id:t,content:e,role:"user",timestamp:new Date};i(e=>[...e,a]),d(!0);try{let a=await fetch("/api/v1/llm/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:g,post_id:s,content:e})});if(!a.ok)throw Error("Failed to get response");let r=await a.json(),l={id:"bot-".concat(t),content:r.data[0]||"抱歉，我没有找到相关信息。",role:"bot",timestamp:new Date};setTimeout(()=>{i(e=>[...e,l]),d(!1)},1e3)}catch(s){let e={id:"error-".concat(t),content:"抱歉，出现了一些问题。请稍后再试。",role:"bot",timestamp:new Date};i(t=>[...t,e]),d(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.P.button,{className:"fixed bottom-6 right-6 w-14 h-14 bg-blue-600 rounded-full flex items-center justify-center shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 z-50 chat-toggle-button",onClick:()=>l(!s),whileHover:{scale:1.05},whileTap:{scale:.95},children:s?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"white",viewBox:"0 0 16 16",children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})}):(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"white",viewBox:"0 0 16 16",children:[(0,a.jsx)("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}),(0,a.jsx)("path",{d:"M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"})]})}),(0,a.jsx)(u.N,{children:s&&(0,a.jsxs)(x.P.div,{className:"fixed bottom-24 right-6 w-96 h-[500px] bg-white rounded-lg shadow-xl overflow-hidden flex flex-col z-50 border border-gray-200 chat-container",style:{width:"384px",maxWidth:"95vw"},initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},transition:{duration:.2},children:[(0,a.jsxs)("div",{className:"bg-blue-600 text-white p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-white mr-3 flex items-center justify-center",children:(0,a.jsx)(w.default,{src:"/favicon.ico",alt:"Bot Avatar",width:24,height:24,className:"rounded-full"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium",children:"HCHEN90 AI助手"}),(0,a.jsx)("p",{className:"text-xs opacity-80",children:"在线"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:y,className:"text-white hover:text-gray-200 p-1 rounded transition-colors",title:"重置会话",children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[(0,a.jsx)("path",{fillRule:"evenodd",d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"}),(0,a.jsx)("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"})]})}),(0,a.jsx)("button",{onClick:()=>l(!1),className:"text-white hover:text-gray-200 p-1 rounded transition-colors",title:"关闭聊天",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:(0,a.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})})})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50 chat-messages",style:{width:"100%",maxWidth:"384px",overflowX:"hidden",overflowWrap:"break-word"},children:(0,a.jsxs)("div",{className:"flex flex-col",style:{maxWidth:"100%"},children:[o.map(e=>(0,a.jsx)(c,{message:e},e.id)),n&&(0,a.jsxs)("div",{className:"flex space-x-2 p-3 rounded-lg bg-gray-200 text-gray-800 mb-4",style:{maxWidth:"280px"},children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full typing-dot"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full typing-dot"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full typing-dot"})]}),(0,a.jsx)("div",{ref:p})]})}),(0,a.jsx)(h,{onSendMessage:j})]})})]})}},645:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,9243,23)),Promise.resolve().then(s.bind(s,415)),Promise.resolve().then(s.t.bind(s,347,23)),Promise.resolve().then(s.t.bind(s,1491,23))},3523:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[653,690,562,766,226,441,684,358],()=>t(645)),_N_E=e.O()}]);