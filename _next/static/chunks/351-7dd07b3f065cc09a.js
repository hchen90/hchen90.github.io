(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[351],{477:()=>{},5513:()=>{},9543:(e,t,a)=>{"use strict";a.d(t,{default:()=>g});var r=a(5155),n=a(2115);function s(){let[e,t]=(0,n.useState)(0),[a,s]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=()=>{let e=window.scrollY,a=document.documentElement.scrollHeight-document.documentElement.clientHeight;t(a>0?e/a*100:0),s(e>400)};return window.addEventListener("scroll",e),e(),()=>window.removeEventListener("scroll",e)},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed top-0 left-0 h-1 bg-blue-500 z-50 transition-all duration-300",style:{width:"".concat(e,"%")}}),(0,r.jsx)("button",{onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},className:"fixed bottom-24 right-8 p-3 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg transition-opacity duration-300 z-50 ".concat(a?"opacity-100":"opacity-0 pointer-events-none"),"aria-label":"Back to top",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,r.jsx)("path",{d:"M12 19V5M5 12l7-7 7 7"})})})]})}function o(){let[e,t]=(0,n.useState)([]),[a,s]=(0,n.useState)(""),[o,l]=(0,n.useState)(!1),[i,c]=(0,n.useState)(!1),d=(0,n.useRef)(null);(0,n.useRef)(null),(0,n.useRef)(null),(0,n.useEffect)(()=>{let e=window.location.pathname;"/"!==e&&e.includes("/post/")||(l(!1),localStorage.setItem("tocVisibility","false"))},[]);let m=(0,n.useCallback)(e=>{e?(document.documentElement.classList.add("toc-visible"),document.documentElement.classList.remove("toc-hidden")):(document.documentElement.classList.remove("toc-visible"),document.documentElement.classList.add("toc-hidden"))},[]);(0,n.useEffect)(()=>{let e=()=>{let e=document.querySelectorAll(".markdown-content h2, .markdown-content h3, .markdown-content h4"),t="";Array.from(e).forEach(e=>{let a=e.getBoundingClientRect();a.top>=0&&a.top<=window.innerHeight/3&&(t=e.id)}),t&&s(t)},a=()=>{c(window.innerWidth<1024),localStorage.getItem("tocVisibilitySet")?l("true"===localStorage.getItem("tocVisibility")):(l(!1),localStorage.setItem("tocVisibilitySet","true"))};return t(Array.from(document.querySelectorAll(".markdown-content h2, .markdown-content h3, .markdown-content h4")).map(e=>({id:e.id,text:e.textContent.replace(" #",""),level:parseInt(e.tagName.substring(1),10)}))),e(),a(),window.addEventListener("scroll",e),window.addEventListener("resize",a),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",a)}},[]),(0,n.useEffect)(()=>{m(o)},[o,m]),(0,n.useEffect)(()=>(0===e.length&&(document.documentElement.classList.remove("toc-visible"),document.documentElement.classList.add("toc-hidden")),()=>{document.documentElement.classList.remove("toc-visible"),document.documentElement.classList.add("toc-hidden")}),[e.length]);let u=e=>{let t=document.getElementById(e);t&&(window.scrollTo({top:t.offsetTop-20,behavior:"smooth"}),i&&l(!1))};return 0===e.length?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:d,className:"toc-container fixed top-0 left-0 bottom-0 z-40 transition-all duration-300 ease-in-out\n          ".concat(o?"translate-x-0":"-translate-x-full"),children:(0,r.jsx)("div",{className:"relative h-full",children:(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 h-full scrollbar-hide hover:scrollbar-default focus-within:scrollbar-default overflow-y-auto p-6 shadow-lg w-72",children:[(0,r.jsx)("div",{className:"flex justify-between items-center mb-5 pt-16 pb-2 border-b border-gray-100 dark:border-gray-700",children:(0,r.jsxs)("h2",{className:"text-lg font-bold text-gray-800 dark:text-gray-100 flex items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 5a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),"目录"]})}),(0,r.jsx)("nav",{className:"relative",children:(0,r.jsx)("ul",{className:"space-y-2 relative",children:e.map(e=>{let t=a===e.id;return(0,r.jsxs)("li",{className:"\n                        ".concat({2:"pl-0 font-medium text-[15px]",3:"pl-4 text-[14px]",4:"pl-8 text-[13px] text-gray-600 dark:text-gray-400"}[e.level]||"","\n                        relative\n                      "),children:[t&&(0,r.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-blue-500 rounded-full transform -translate-x-2"}),(0,r.jsx)("button",{onClick:()=>u(e.id),className:"\n                          py-1.5 hover:text-blue-600 dark:hover:text-blue-400 focus:outline-none text-left w-full truncate \n                          transition-all duration-200 rounded px-2 -ml-2\n                          ".concat(t?"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 font-medium":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800/50","\n                        "),children:(0,r.jsxs)("div",{className:"flex items-center",children:[2===e.level&&(0,r.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 dark:bg-gray-500 mr-2 flex-shrink-0"}),e.text]})})]},e.id)})})})]})})}),(0,r.jsx)("button",{onClick:()=>{let e=!o;l(e),localStorage.setItem("tocVisibilitySet","true"),localStorage.setItem("tocVisibility",e.toString())},className:"\n          fixed bottom-8 left-8 z-50 p-3 rounded-full \n          shadow-lg transition-all duration-300\n          ".concat(o?"bg-red-500 hover:bg-red-600 rotate-180":"bg-blue-500 hover:bg-blue-600","\n          text-white\n        "),"aria-label":o?"隐藏目录":"显示目录",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o?(0,r.jsx)("path",{d:"M15 18l-6-6 6-6"}):(0,r.jsx)("path",{d:"M9 18l6-6-6-6"})})})]})}var l=a(6874),i=a.n(l);function c(e){let{comments:t,currentUser:a,onDelete:n}=e,s=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return 0===t.length?(0,r.jsx)("p",{className:"text-gray-500 italic",children:"暂无评论。快来分享你的想法吧！"}):(0,r.jsx)("div",{className:"space-y-6",children:t.map(e=>(0,r.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("img",{src:"/api/v1/avatar/".concat(e.user_id),alt:"User avatar",className:"w-8 h-8 rounded-full mr-2"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium dark:text-gray-100",children:e.user_name||"User ".concat(e.user_id)}),(0,r.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-300 ml-2",children:s(e.created)})]})]}),a&&a.user_id===e.user_id&&(0,r.jsx)("button",{onClick:()=>n(e.id),className:"text-red-500 hover:text-red-700 text-sm","aria-label":"Delete comment",children:"Delete"})]}),(0,r.jsx)("div",{className:"mt-2 whitespace-pre-wrap dark:text-gray-100",children:e.content})]},e.id))})}function d(e){let{onSubmit:t}=e,[a,s]=(0,n.useState)(""),[o,l]=(0,n.useState)(!1),i=async e=>{if(e.preventDefault(),a.trim()){l(!0);try{await t(a),s("")}finally{l(!1)}}};return(0,r.jsxs)("form",{onSubmit:i,className:"space-y-4",children:[(0,r.jsx)("div",{children:(0,r.jsx)("textarea",{value:a,onChange:e=>s(e.target.value),placeholder:"分享您的想法...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100 resize-none",rows:4,required:!0,disabled:o})}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("button",{type:"submit",disabled:o||!a.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"提交中...":"提交评论"})})]})}function m(){let[e,t]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t=e.get("code"),r=e.get("state"),n=sessionStorage.getItem("github_oauth_state");t&&r&&n===r&&(a(t),window.history.replaceState({},document.title,window.location.pathname))},[]);let a=async e=>{t(!0);try{let t=await fetch("/api/v1/github_token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:"b21df0e3f89265d7584c",code:e})}),a=await t.json();a.code?(console.error("登录失败:",a.error),alert("GitHub登录失败，请重试")):window.location.reload()}catch(e){console.error("登录过程中出错:",e),alert("登录过程中出错，请重试")}finally{t(!1),sessionStorage.removeItem("github_oauth_state")}};return(0,r.jsxs)("button",{onClick:()=>{let e=Math.random().toString(36).substring(2,15);sessionStorage.setItem("github_oauth_state",e);let t=encodeURIComponent(window.location.href),a="https://github.com/login/oauth/authorize?client_id=".concat("b21df0e3f89265d7584c","&redirect_uri=").concat(t,"&state=").concat(e);window.location.href=a},disabled:e,className:"flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800 focus:outline-none ".concat(e?"opacity-70 cursor-not-allowed":""),children:[e?(0,r.jsx)("span",{className:"inline-block animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2"}):(0,r.jsx)("svg",{width:"20",height:"20",fill:"white",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"})}),e?"登录中...":"使用GitHub登录"]})}function u(e){let{postId:t}=e,[a,s]=(0,n.useState)([]),[o,l]=(0,n.useState)(!0),[i,u]=(0,n.useState)(null),[h,x]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/v1/user");if(e.ok){let t=await e.json();0===t.code&&t.data&&x(t.data)}}catch(e){console.error("Error fetching user info:",e)}})()},[]),(0,n.useEffect)(()=>{let e=async()=>{l(!0);try{let e=await fetch("/api/v1/posts/".concat(t,"/comments"));if(!e.ok)throw Error("Failed to fetch comments");let a=await e.json();0===a.code&&a.data?s(a.data):s([])}catch(e){console.error("Error fetching comments:",e),u("Could not load comments. Please try again later.")}finally{l(!1)}};t&&e()},[t]);let g=async e=>{if(h)try{if(!(await fetch("/api/v1/posts/".concat(t,"/comments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:h.user_id,user_name:h.username,content:e})})).ok)throw Error("Failed to post comment");let a=await fetch("/api/v1/posts/".concat(t,"/comments")),r=await a.json();0===r.code&&r.data&&s(r.data)}catch(e){console.error("Error posting comment:",e),u("Failed to post your comment. Please try again.")}},b=async e=>{if(h)try{if(!(await fetch("/api/v1/posts/".concat(t,"/comments/").concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete comment");s(a.filter(t=>t.id!==e))}catch(e){console.error("Error deleting comment:",e),u("Failed to delete the comment. Please try again.")}};return(0,r.jsxs)("div",{className:"mt-16 pt-8 border-t border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"博客评论"}),o?(0,r.jsx)("p",{children:"Loading comments..."}):i?(0,r.jsx)("p",{className:"text-red-500",children:i}):(0,r.jsxs)(r.Fragment,{children:[h?(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center mb-4",children:[(0,r.jsx)("img",{src:h.avatar_url,alt:h.username,className:"w-10 h-10 rounded-full mr-3"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:h.username}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:h.login})]})]}),(0,r.jsx)(d,{onSubmit:g})]}):(0,r.jsxs)("div",{className:"mb-8 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,r.jsx)("p",{className:"mb-3 dark:text-gray-100",children:"Sign in with GitHub to join the discussion"}),(0,r.jsx)(m,{})]}),(0,r.jsx)(c,{comments:a,currentUser:h,onDelete:b})]})]})}var h=a(9734),x=a.n(h);function g(e){let{postData:t}=e,[a,l]=(0,n.useState)(!1);(0,n.useEffect)(()=>{l(!0)},[]);let c=t.date instanceof Date?t.date.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):t.date,d=x()(t.id).toString();return(0,r.jsxs)("div",{className:"min-h-screen relative",children:[(0,r.jsx)(s,{}),(0,r.jsx)(o,{}),(0,r.jsx)("div",{className:"main-content transition-all duration-300",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsx)(i(),{href:"/",className:"text-blue-500 hover:underline mb-4 inline-block",children:"← 返回首页"})}),(0,r.jsxs)("article",{children:[(0,r.jsxs)("header",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold mb-4",children:t.title}),(0,r.jsx)("div",{className:"text-gray-500 mb-4",children:c}),t.tags&&"string"==typeof t.tags&&""!==t.tags.trim()&&(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:t.tags.split(",").map(e=>(0,r.jsx)("span",{className:"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded-full",children:e.trim()},e.trim()))})]}),(0,r.jsx)("div",{className:"markdown-content",dangerouslySetInnerHTML:{__html:t.contentHtml}}),a&&(0,r.jsx)(u,{postId:d}),(0,r.jsx)("div",{className:"mt-12 pt-6 border-t border-gray-200 dark:border-gray-700",children:(0,r.jsx)(i(),{href:"/",className:"text-blue-500 hover:underline",children:"← 返回所有文章列表"})}),(0,r.jsx)("div",{className:"mt-8 pt-4 border-t border-gray-200 dark:border-gray-700 text-center text-gray-500 text-sm",children:"\xa9 2013 – 2025 陈祥"})]})]})})]})}},9867:(e,t,a)=>{Promise.resolve().then(a.bind(a,9543)),Promise.resolve().then(a.t.bind(a,5513,23))}}]);