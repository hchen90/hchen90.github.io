<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/283bb1ed86b49fd2.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/09ec4099fb721b31.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/09dfadb69bdaa005.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/54b9acc791aa599c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-ede82f7d0ae11dac.js"/><script src="/_next/static/chunks/4bd1b696-299743f5624cdabe.js" async=""></script><script src="/_next/static/chunks/684-481501000630d05e.js" async=""></script><script src="/_next/static/chunks/main-app-eb9456c5a3bb7ef4.js" async=""></script><script src="/_next/static/chunks/766-f505dbd3efffaa4c.js" async=""></script><script src="/_next/static/chunks/226-13d4d3f1fc18ceb6.js" async=""></script><script src="/_next/static/chunks/app/layout-bc83bfd6141341e7.js" async=""></script><script src="/_next/static/chunks/874-e909718850e7282e.js" async=""></script><script src="/_next/static/chunks/734-02ba314a893e68e9.js" async=""></script><script src="/_next/static/chunks/351-7dd07b3f065cc09a.js" async=""></script><script src="/_next/static/chunks/app/post/%5Bid%5D/page-871a46f82159f9c4.js" async=""></script><title>LZ77压缩算法</title><meta name="description" content="HCHEN90 博客"/><link rel="alternate" type="application/atom+xml" href="https://hchen90.top/atom.xml"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="antialiased relative"><div class="fixed top-4 right-4 z-50"><a href="https://github.com/hchen90" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow duration-300" title="Visit my GitHub profile"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></div><div class="min-h-screen relative"><div class="fixed top-0 left-0 h-1 bg-blue-500 z-50 transition-all duration-300" style="width:0%"></div><button class="fixed bottom-24 right-8 p-3 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg transition-opacity duration-300 z-50 opacity-0 pointer-events-none" aria-label="Back to top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"></path></svg></button><div class="main-content transition-all duration-300"><div class="max-w-4xl mx-auto px-4 py-8"><div class="mb-8"><a class="text-blue-500 hover:underline mb-4 inline-block" href="/">← 返回首页</a></div><article><header class="mb-8"><h1 class="text-4xl font-bold mb-4">LZ77压缩算法</h1><div class="text-gray-500 mb-4">2018年4月1日</div></header><div class="markdown-content"><h1 id="lz77算法简介">LZ77算法简介<a aria-hidden="true" tabindex="-1" href="#lz77算法简介"><span class="anchor-link"> #</span></a></h1>
<p>LZ77算法是一种无损压缩算法，最早由两位以色列人于1977发表，它是一种典型的字典型压缩算法，目前几乎大多数的无损压缩算法都是基于这个LZ77算法，也就是在其基础上优化修改，此算法可以称得上是无损压缩算法界的鼻祖了。</p>
<blockquote>
<p>参考维基百科<a href="https://en.wikipedia.org/wiki/LZ77_and_LZ78">lz77</a></p>
</blockquote>
<h1 id="算法逻辑">算法逻辑<a aria-hidden="true" tabindex="-1" href="#算法逻辑"><span class="anchor-link"> #</span></a></h1>
<p>LZ77的算法核心就是一个滑动窗口，在滑动窗口里面搜索重复字节，并将匹配到的字节串用更短的字节串方式表示出来。</p>
<p>这里涉及到几个要素：</p>
<ul>
<li>滑动窗口缓冲区</li>
<li>滑窗的前部区域</li>
<li>滑窗的已编码区域</li>
</ul>
<h2 id="编码流程">编码流程<a aria-hidden="true" tabindex="-1" href="#编码流程"><span class="anchor-link"> #</span></a></h2>
<p>编码步骤：</p>
<ol>
<li>首先分配一块缓冲区域用来处理数据</li>
<li>初始的前部区域为空</li>
<li>初始的已编码区域也为空</li>
<li>加载的字节流到前部区域，是否最后一个字节，是则进行第8步，否则继续第5步</li>
<li>在已编码区域寻找匹配字节串，如果找到进行第6步，否则进行第7步</li>
<li>将匹配到的第一个字节的相对位置和长度，标记到已编码区域中，继续第4步</li>
<li>将前部区域的字节直接拷贝到已编码区域，继续第4步</li>
<li>编码结束</li>
</ol>
<p>编码图示：</p>
<p>当滑动窗口还没有处理数据时：</p>
<p><img src="/post/lz77compalgo/444d473374ac.png" alt="stepprecomp"></p>
<p>当滑动窗口开始处理数据时：</p>
<p><img src="/post/lz77compalgo/bbe2cf390348.png" alt="stepcomp"></p>
<p>当滑动窗口正在处理数据时：</p>
<p><img src="/post/lz77compalgo/c2b4e19aa15f.png" alt="stepcomping"></p>
<p>当数据快要处理完时：</p>
<p><img src="/post/lz77compalgo/a2b9a5ac780a.png" alt="stepcompfin"></p>
<p>整个过程如同字节流在这个滑动窗口的黑盒子里面流动过一样，然后，它被加工的数据是已经压缩的数据了。</p>
<blockquote>
<p>数据编码中，会涉及到如何标记数据，在lz77算法中是用2-3个字节来表示的，即：如果有两个自己是'\0'，则表示它是一个直译字节，是直接拷贝过来的字节，这两个'\0'后面的字节就是原始字节；否则，这两个字节是表示当前字节处应该填充的字节串应该在的相对位置和长度（你甚至可以为你自己的lz77编码器自定义数据标记方式）。</p>
</blockquote>
<h2 id="解码流程">解码流程<a aria-hidden="true" tabindex="-1" href="#解码流程"><span class="anchor-link"> #</span></a></h2>
<p>解码的过程是编码过程的逆过程。</p>
<p>解码步骤：</p>
<ol>
<li>
<p>字节流是否是最后字节，是则进行第5步，否则进行第2步</p>
</li>
<li>
<p>从字节流获取两个字节，如果是<code>\0x00\0x00</code>则进行第3步，否则进行第4步</p>
</li>
<li>
<p>将<code>\0x00\0x00</code>后面的一个字节复制到输出缓存区域，继续加载字节流，继续第1步</p>
</li>
<li>
<p>从两个字节的编码中得到在滑动窗口的相对偏移和内容长度，把偏移处的内容拷贝到当前输出缓存，继续第1步</p>
</li>
<li>
<p>解码结束</p>
</li>
</ol>
<blockquote>
<p>上面的输出缓存区域是指在字节处理位置处理过后的字节流存放的缓存区域就是输出缓存</p>
</blockquote>
<p>解码图示：</p>
<p>滑动窗口还没有输入数据的时候：</p>
<p><img src="/post/lz77compalgo/327cac22a173.png" alt="stepuncomp"></p>
<p>滑动窗口开始处理数据的时候：</p>
<p><img src="/post/lz77compalgo/0f3c09c33bfb.png" alt="stepuncomp"></p>
<p>数据在滑动窗口中处理：</p>
<p><img src="/post/lz77compalgo/44818fe4e513.png" alt="stepuncomping"></p>
<p>数据快要处理完的时候：</p>
<p><img src="/post/lz77compalgo/a0e2f344a5e9.png" alt="stepuncompfin"></p>
<h1 id="源码实现">源码实现<a aria-hidden="true" tabindex="-1" href="#源码实现"><span class="anchor-link"> #</span></a></h1>
<p>辅助函数：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">c</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">search_maxlen_p</span><span class="hljs-params">( <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>**  pt, \
                              <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* head, \
                              <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* tail, \
                              <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* end)</span>
{
  <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* tmp = *pt;
  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> leng = <span class="hljs-number">0</span>, i;

  <span class="hljs-keyword">for</span>(tmp;tmp >= head;tmp--){
    <span class="hljs-keyword">if</span>(tmp[<span class="hljs-number">0</span>] == tail[<span class="hljs-number">0</span>]){
      <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>;(i &#x3C; ((<span class="hljs-number">1</span> &#x3C;&#x3C; LENGTHBITS) - <span class="hljs-number">1</span>)) &#x26;&#x26; (&#x26;tmp[i] > head) &#x26;&#x26; (&#x26;tmp[i] &#x3C; tail) &#x26;&#x26; (&#x26;tail[i] &#x3C; end) &#x26;&#x26; (tmp[i] == tail[i]);i++);
      <span class="hljs-keyword">if</span>(i > leng){
        leng = i;
        *pt = tmp;
      }
    }
  }
  <span class="hljs-keyword">return</span> leng;
}
</code></pre></div>
<p>编码实现：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">c</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">lz77_encode</span><span class="hljs-params">(FILE* in,FILE* out)</span>
{
  <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* buf = <span class="hljs-number">0</span>,* head = <span class="hljs-number">0</span>,* tail = <span class="hljs-number">0</span>;
  <span class="hljs-type">long</span> size = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">if</span>(! in || ! out)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  get_filesize(in,size); <span class="hljs-comment">// get file size.</span>
  <span class="hljs-keyword">if</span>(size &#x3C;= <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  buf = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(size* <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)); <span class="hljs-comment">// allocate memory.</span>
  <span class="hljs-keyword">if</span>(! buf)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  <span class="hljs-keyword">if</span>(fread(buf,<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>),size,in) == size){
    head = tail = buf;
    fputc((size >> <span class="hljs-number">24</span>) &#x26; <span class="hljs-number">0xff</span>,out);
    fputc((size >> <span class="hljs-number">16</span>) &#x26; <span class="hljs-number">0xff</span>,out);
    fputc((size >>  <span class="hljs-number">8</span>) &#x26; <span class="hljs-number">0xff</span>,out);
    fputc((size >>  <span class="hljs-number">0</span>) &#x26; <span class="hljs-number">0xff</span>,out);

    <span class="hljs-keyword">for</span>(;;){ <span class="hljs-comment">// loop block.</span>
      head = tail - WINDOWSIZE;
      <span class="hljs-keyword">if</span>(buf  > head)head = buf;
      <span class="hljs-keyword">if</span>(tail > buf + size - <span class="hljs-number">1</span>)<span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">if</span>(tail > head){
        <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* pt = tail - <span class="hljs-number">1</span>;
        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> bytes = <span class="hljs-number">0</span>;
        bytes = search_maxlen_p(&#x26;pt,head,tail,buf + size);
        <span class="hljs-comment">// search maximal matched bytes and position.</span>
        <span class="hljs-keyword">if</span>(bytes > <span class="hljs-number">0</span>){
          <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> chars[<span class="hljs-number">2</span>] = {<span class="hljs-number">0</span>};
          chars[<span class="hljs-number">0</span>] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)(( (tail - pt) >> LENGTHBITS) &#x26; <span class="hljs-number">0xff</span>);
          chars[<span class="hljs-number">1</span>] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)((((tail - pt) &#x3C;&#x3C; LENGTHBITS) + bytes) &#x26; <span class="hljs-number">0xff</span>);
          fputc(chars[<span class="hljs-number">0</span>],out);
          fputc(chars[<span class="hljs-number">1</span>],out);
          <span class="hljs-comment">//fprintf(stderr,"{%d - %d}",tail - pt,bytes);</span>
          tail += bytes;
        } <span class="hljs-keyword">else</span> {
          fputc(<span class="hljs-number">0</span>,out);
          fputc(<span class="hljs-number">0</span>,out);
          fputc(*tail,out);
          tail++;
        }
      } <span class="hljs-keyword">else</span> {
        fputc(<span class="hljs-number">0</span>,out);
        fputc(<span class="hljs-number">0</span>,out);
        fputc(*tail,out);
        tail++;
      }
    }

  }

  <span class="hljs-built_in">free</span>(buf);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre></div>
<p>解码实现：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">c</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">lz77_decode</span><span class="hljs-params">(FILE* in,FILE* out)</span>
{
  <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* nbuf = <span class="hljs-number">0</span>,* ori_buf = <span class="hljs-number">0</span>,* head = <span class="hljs-number">0</span>,* tail = <span class="hljs-number">0</span>;
  <span class="hljs-type">long</span> ori_size = <span class="hljs-number">0</span>,nsize = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">if</span>(! in || ! out)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  get_filesize(in,nsize); <span class="hljs-comment">// get file size.</span>
  <span class="hljs-keyword">if</span>(nsize &#x3C;= <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  ori_size  = (fgetc(in) &#x26; <span class="hljs-number">0xff</span>) &#x3C;&#x3C; <span class="hljs-number">24</span>;
  ori_size += (fgetc(in) &#x26; <span class="hljs-number">0xff</span>) &#x3C;&#x3C; <span class="hljs-number">16</span>;
  ori_size += (fgetc(in) &#x26; <span class="hljs-number">0xff</span>) &#x3C;&#x3C;  <span class="hljs-number">8</span>;
  ori_size += (fgetc(in) &#x26; <span class="hljs-number">0xff</span>) &#x3C;&#x3C;  <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span>(ori_size &#x3C;= <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  nbuf = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(nsize* <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>));
  <span class="hljs-keyword">if</span>(! nbuf)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  ori_buf = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(ori_size* <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>));
  <span class="hljs-keyword">if</span>(ori_buf){
    head = tail = ori_buf; <span class="hljs-comment">// store head and tail of slide-window.</span>

    <span class="hljs-keyword">if</span>(fread(nbuf,<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>),nsize,in) == (nsize - <span class="hljs-number">4</span>)){
      <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* pt  = nbuf;

      <span class="hljs-keyword">for</span>(;;){
        <span class="hljs-keyword">if</span>(pt >= (nbuf + nsize - <span class="hljs-number">4</span>))<span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">if</span>(! pt[<span class="hljs-number">0</span>] &#x26;&#x26; ! pt[<span class="hljs-number">1</span>] ){ <span class="hljs-comment">// \0\0\?</span>
          tail[<span class="hljs-number">0</span>] = pt[<span class="hljs-number">2</span>];
          tail++;
          pt += <span class="hljs-number">3</span>;
        } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// \?\?</span>
          <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> offset = <span class="hljs-number">0</span>,length = <span class="hljs-number">0</span>,i;
          offset  =  pt[<span class="hljs-number">0</span>] &#x3C;&#x3C; LENGTHBITS;
          offset += (pt[<span class="hljs-number">1</span>] >> LENGTHBITS) &#x26; <span class="hljs-number">0x0f</span>;
          length  =  pt[<span class="hljs-number">1</span>] &#x26; <span class="hljs-number">0x0f</span>;
          <span class="hljs-comment">//fprintf(stderr,"{%d - %d}",offset,length);</span>
          <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>;i &#x3C; length;i++){
            tail[i] = ((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)(tail - offset))[i];
          }
          tail += length;
          pt += <span class="hljs-number">2</span>;
        }
      }
      fwrite(ori_buf,<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>),ori_size,out);
    }

    <span class="hljs-built_in">free</span>(ori_buf);
  }

  <span class="hljs-built_in">free</span>(nbuf);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre></div>
<h1 id="算法分析">算法分析<a aria-hidden="true" tabindex="-1" href="#算法分析"><span class="anchor-link"> #</span></a></h1>
<p>在分析此算法压缩的数据效率如何时，可以看到和数据的内容有关，若重复率比较高，而且间隔距离短的内容，可以得到比较理想的压缩率，但是对于重复率低的内容就不一定能达到理想的压缩率，最差的情况就是，要压缩的内容刚刚好在滑动窗口大小的缓存都没有重复内容，那么压缩出来的数据不仅没有变小，而且增大到原来的3倍。</p>
<p>下图中的数据可以看到前面部分的非重复的数据就有许多的<code>"\0x00\0x00"</code>开头的直译复制过来的数据，这种数据过多就会导致压缩效率低下。</p>
<p><img src="/post/lz77compalgo/0ae608b93872.png" alt="hexdat"></p>
<p>一般来说，用LZ77算法压缩过的数据，为了抵消上面的劣势，可以将用LZ77压缩的数据再用哈夫曼编码再次编码，这样输出的数据压缩效率就高一些了。</p>
<p>链接：<a href="https://github.com/hchen90/lz77">Github上的代码</a></p></div><div class="mt-12 pt-6 border-t border-gray-200 dark:border-gray-700"><a class="text-blue-500 hover:underline" href="/">← 返回所有文章列表</a></div><div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700 text-center text-gray-500 text-sm">© 2013 – 2025 陈祥</div></article></div></div></div><!--$--><!--/$--><!--$--><!--/$--><script src="/_next/static/chunks/webpack-ede82f7d0ae11dac.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7555,[],\"\"]\n3:I[1295,[],\"\"]\n4:I[415,[\"766\",\"static/chunks/766-f505dbd3efffaa4c.js\",\"226\",\"static/chunks/226-13d4d3f1fc18ceb6.js\",\"177\",\"static/chunks/app/layout-bc83bfd6141341e7.js\"],\"default\"]\n5:I[9243,[\"766\",\"static/chunks/766-f505dbd3efffaa4c.js\",\"226\",\"static/chunks/226-13d4d3f1fc18ceb6.js\",\"177\",\"static/chunks/app/layout-bc83bfd6141341e7.js\"],\"\"]\n8:I[9665,[],\"MetadataBoundary\"]\na:I[9665,[],\"OutletBoundary\"]\nd:I[4911,[],\"AsyncMetadataOutlet\"]\nf:I[9665,[],\"ViewportBoundary\"]\n11:I[6614,[],\"\"]\n:HL[\"/_next/static/css/283bb1ed86b49fd2.css\",\"style\"]\n:HL[\"/_next/static/css/09ec4099fb721b31.css\",\"style\"]\n:HL[\"/_next/static/css/09dfadb69bdaa005.css\",\"style\"]\n:HL[\"/_next/static/css/54b9acc791aa599c.css\",\"style\"]\n6:T4a2,\n          function copyCode(button) {\n            // Find the code element within the same wrapper\n            const codeWrapper = button.closest('.code-block-wrapper');\n            if (!codeWrapper) return;\n            \n            const codeElement = codeWrapper.querySelector('code');\n            if (!codeElement) return;\n            \n            // Get the text content\n            const text = codeElement.textContent;\n            \n            // Use the clipboard API to copy the text\n            navigator.clipboard.writeText(text).then(() =\u003e {\n              // Update the button state to show \"Copied!\"\n              button.setAttribute('data-copy-state', 'copied');\n              const buttonText = button.querySelector('.copy-button-text');\n              if (buttonText) buttonText.textContent = 'Copied!';\n              \n              // Reset after 2 seconds\n              setTimeout(() =\u003e {\n                button.setAttribute('data-copy-state', 'copy');\n                if (buttonText) buttonText.textContent = 'Copy';\n              }, 2000);\n            }).catch(err =\u003e {\n              console.error('Failed to copy text: ', err);\n            });\n          }\n          "])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"ZnA_pffjAXy0PvB3tEph0\",\"p\":\"\",\"c\":[\"\",\"post\",\"lz77compalgo\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"post\",{\"children\":[[\"id\",\"lz77compalgo\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/283bb1ed86b49fd2.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/09ec4099fb721b31.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/09dfadb69bdaa005.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"antialiased relative\",\"children\":[[\"$\",\"div\",null,{\"className\":\"fixed top-4 right-4 z-50\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/hchen90\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"flex items-center justify-center p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow duration-300\",\"title\":\"Visit my GitHub profile\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"24\",\"height\":\"24\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\"}]}]}]}],[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"$L4\",null,{}],[\"$\",\"$L5\",null,{\"id\":\"code-copy\",\"children\":\"$6\"}]]}]}]]}],{\"children\":[\"post\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"lz77compalgo\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/54b9acc791aa599c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"N0sc5PnDkcoBN25VceSzo\",{\"children\":[[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$11\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"12:\"$Sreact.suspense\"\n13:I[4911,[],\"AsyncMetadata\"]\n9:[\"$\",\"$12\",null,{\"fallback\":null,\"children\":[\"$\",\"$L13\",null,{\"promise\":\"$@14\"}]}]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script><script>self.__next_f.push([1,"15:I[9543,[\"874\",\"static/chunks/874-e909718850e7282e.js\",\"734\",\"static/chunks/734-02ba314a893e68e9.js\",\"351\",\"static/chunks/351-7dd07b3f065cc09a.js\",\"457\",\"static/chunks/app/post/%5Bid%5D/page-871a46f82159f9c4.js\"],\"default\"]\n16:T4226,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"lz77算法简介\"\u003eLZ77算法简介\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#lz77算法简介\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eLZ77算法是一种无损压缩算法，最早由两位以色列人于1977发表，它是一种典型的字典型压缩算法，目前几乎大多数的无损压缩算法都是基于这个LZ77算法，也就是在其基础上优化修改，此算法可以称得上是无损压缩算法界的鼻祖了。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考维基百科\u003ca href=\"https://en.wikipedia.org/wiki/LZ77_and_LZ78\"\u003elz77\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"算法逻辑\"\u003e算法逻辑\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#算法逻辑\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eLZ77的算法核心就是一个滑动窗口，在滑动窗口里面搜索重复字节，并将匹配到的字节串用更短的字节串方式表示出来。\u003c/p\u003e\n\u003cp\u003e这里涉及到几个要素：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e滑动窗口缓冲区\u003c/li\u003e\n\u003cli\u003e滑窗的前部区域\u003c/li\u003e\n\u003cli\u003e滑窗的已编码区域\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"编码流程\"\u003e编码流程\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#编码流程\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e编码步骤：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e首先分配一块缓冲区域用来处理数据\u003c/li\u003e\n\u003cli\u003e初始的前部区域为空\u003c/li\u003e\n\u003cli\u003e初始的已编码区域也为空\u003c/li\u003e\n\u003cli\u003e加载的字节流到前部区域，是否最后一个字节，是则进行第8步，否则继续第5步\u003c/li\u003e\n\u003cli\u003e在已编码区域寻找匹配字节串，如果找到进行第6步，否则进行第7步\u003c/li\u003e\n\u003cli\u003e将匹配到的第一个字节的相对位置和长度，标记到已编码区域中，继续第4步\u003c/li\u003e\n\u003cli\u003e将前部区域的字节直接拷贝到已编码区域，继续第4步\u003c/li\u003e\n\u003cli\u003e编码结束\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e编码图示：\u003c/p\u003e\n\u003cp\u003e当滑动窗口还没有处理数据时：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lz77compalgo/444d473374ac.png\" alt=\"stepprecomp\"\u003e\u003c/p\u003e\n\u003cp\u003e当滑动窗口开始处理数据时：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lz77compalgo/bbe2cf390348.png\" alt=\"stepcomp\"\u003e\u003c/p\u003e\n\u003cp\u003e当滑动窗口正在处理数据时：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lz77compalgo/c2b4e19aa15f.png\" alt=\"stepcomping\"\u003e\u003c/p\u003e\n\u003cp\u003e当数据快要处理完时：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lz77compalgo/a2b9a5ac780a.png\" alt=\"stepcompfin\"\u003e\u003c/p\u003e\n\u003cp\u003e整个过程如同字节流在这个滑动窗口的黑盒子里面流动过一样，然后，它被加工的数据是已经压缩的数据了。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e数据编码中，会涉及到如何标记数据，在lz77算法中是用2-3个字节来表示的，即：如果有两个自己是'\\0'，则表示它是一个直译字节，是直接拷贝过来的字节，这两个'\\0'后面的字节就是原始字节；否则，这两个字节是表示当前字节处应该填充的字节串应该在的相对位置和长度（你甚至可以为你自己的lz77编码器自定义数据标记方式）。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"解码流程\"\u003e解码流程\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#解码流程\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e解码的过程是编码过程的逆过程。\u003c/p\u003e\n\u003cp\u003e解码步骤：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e字节流是否是最后字节，是则进行第5步，否则进行第2步\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e从字节流获取两个字节，如果是\u003ccode\u003e\\0x00\\0x00\u003c/code\u003e则进行第3步，否则进行第4步\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e将\u003ccode\u003e\\0x00\\0x00\u003c/code\u003e后面的一个字节复制到输出缓存区域，继续加载字节流，继续第1步\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e从两个字节的编码中得到在滑动窗口的相对偏移和内容长度，把偏移处的内容拷贝到当前输出缓存，继续第1步\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e解码结束\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\n\u003cp\u003e上面的输出缓存区域是指在字节处理位置处理过后的字节流存放的缓存区域就是输出缓存\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e解码图示：\u003c/p\u003e\n\u003cp\u003e滑动窗口还没有输入数据的时候：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lz77compalgo/327cac22a173.png\" alt=\"stepuncomp\"\u003e\u003c/p\u003e\n\u003cp\u003e滑动窗口开始处理数据的时候：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lz77compalgo/0f3c09c33bfb.png\" alt=\"stepuncomp\"\u003e\u003c/p\u003e\n\u003cp\u003e数据在滑动窗口中处理：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lz77compalgo/44818fe4e513.png\" alt=\"stepuncomping\"\u003e\u003c/p\u003e\n\u003cp\u003e数据快要处理完的时候：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lz77compalgo/a0e2f344a5e9.png\" alt=\"stepuncompfin\"\u003e\u003c/p\u003e\n\u003ch1 id=\"源码实现\"\u003e源码实现\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#源码实现\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e辅助函数：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ec\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c\"\u003e\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esearch_maxlen_p\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e( \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e**  pt, \\\n                              \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* head, \\\n                              \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* tail, \\\n                              \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* end)\u003c/span\u003e\n{\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* tmp = *pt;\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e leng = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, i;\n\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(tmp;tmp \u003e= head;tmp--){\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(tmp[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] == tail[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]){\n      \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;(i \u0026#x3C; ((\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u0026#x3C;\u0026#x3C; LENGTHBITS) - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)) \u0026#x26;\u0026#x26; (\u0026#x26;tmp[i] \u003e head) \u0026#x26;\u0026#x26; (\u0026#x26;tmp[i] \u0026#x3C; tail) \u0026#x26;\u0026#x26; (\u0026#x26;tail[i] \u0026#x3C; end) \u0026#x26;\u0026#x26; (tmp[i] == tail[i]);i++);\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(i \u003e leng){\n        leng = i;\n        *pt = tmp;\n      }\n    }\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e leng;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e编码实现：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ec\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c\"\u003e\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003elz77_encode\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(FILE* in,FILE* out)\u003c/span\u003e\n{\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* buf = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,* head = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,* tail = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e size = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(! in || ! out)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  get_filesize(in,size); \u003cspan class=\"hljs-comment\"\u003e// get file size.\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(size \u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  buf = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e*)\u003cspan class=\"hljs-built_in\"\u003emalloc\u003c/span\u003e(size* \u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e)); \u003cspan class=\"hljs-comment\"\u003e// allocate memory.\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(! buf)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(fread(buf,\u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e),size,in) == size){\n    head = tail = buf;\n    fputc((size \u003e\u003e \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e,out);\n    fputc((size \u003e\u003e \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e,out);\n    fputc((size \u003e\u003e  \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e,out);\n    fputc((size \u003e\u003e  \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e,out);\n\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(;;){ \u003cspan class=\"hljs-comment\"\u003e// loop block.\u003c/span\u003e\n      head = tail - WINDOWSIZE;\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(buf  \u003e head)head = buf;\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(tail \u003e buf + size - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(tail \u003e head){\n        \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* pt = tail - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e bytes = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        bytes = search_maxlen_p(\u0026#x26;pt,head,tail,buf + size);\n        \u003cspan class=\"hljs-comment\"\u003e// search maximal matched bytes and position.\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(bytes \u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e){\n          \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e chars[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e] = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e};\n          chars[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e)(( (tail - pt) \u003e\u003e LENGTHBITS) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e);\n          chars[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e)((((tail - pt) \u0026#x3C;\u0026#x3C; LENGTHBITS) + bytes) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e);\n          fputc(chars[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e],out);\n          fputc(chars[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e],out);\n          \u003cspan class=\"hljs-comment\"\u003e//fprintf(stderr,\"{%d - %d}\",tail - pt,bytes);\u003c/span\u003e\n          tail += bytes;\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n          fputc(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,out);\n          fputc(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,out);\n          fputc(*tail,out);\n          tail++;\n        }\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        fputc(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,out);\n        fputc(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,out);\n        fputc(*tail,out);\n        tail++;\n      }\n    }\n\n  }\n\n  \u003cspan class=\"hljs-built_in\"\u003efree\u003c/span\u003e(buf);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e解码实现：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ec\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c\"\u003e\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003elz77_decode\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(FILE* in,FILE* out)\u003c/span\u003e\n{\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* nbuf = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,* ori_buf = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,* head = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,* tail = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e ori_size = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,nsize = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(! in || ! out)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  get_filesize(in,nsize); \u003cspan class=\"hljs-comment\"\u003e// get file size.\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(nsize \u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  ori_size  = (fgetc(in) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e) \u0026#x3C;\u0026#x3C; \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e;\n  ori_size += (fgetc(in) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e) \u0026#x3C;\u0026#x3C; \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e;\n  ori_size += (fgetc(in) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e) \u0026#x3C;\u0026#x3C;  \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e;\n  ori_size += (fgetc(in) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e) \u0026#x3C;\u0026#x3C;  \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(ori_size \u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  nbuf = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e*)\u003cspan class=\"hljs-built_in\"\u003emalloc\u003c/span\u003e(nsize* \u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e));\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(! nbuf)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  ori_buf = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e*)\u003cspan class=\"hljs-built_in\"\u003emalloc\u003c/span\u003e(ori_size* \u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e));\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(ori_buf){\n    head = tail = ori_buf; \u003cspan class=\"hljs-comment\"\u003e// store head and tail of slide-window.\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(fread(nbuf,\u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e),nsize,in) == (nsize - \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e)){\n      \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* pt  = nbuf;\n\n      \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(;;){\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(pt \u003e= (nbuf + nsize - \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e))\u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(! pt[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] \u0026#x26;\u0026#x26; ! pt[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] ){ \u003cspan class=\"hljs-comment\"\u003e// \\0\\0\\?\u003c/span\u003e\n          tail[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] = pt[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\n          tail++;\n          pt += \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e { \u003cspan class=\"hljs-comment\"\u003e// \\?\\?\u003c/span\u003e\n          \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e offset = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,length = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,i;\n          offset  =  pt[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] \u0026#x3C;\u0026#x3C; LENGTHBITS;\n          offset += (pt[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] \u003e\u003e LENGTHBITS) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0x0f\u003c/span\u003e;\n          length  =  pt[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0x0f\u003c/span\u003e;\n          \u003cspan class=\"hljs-comment\"\u003e//fprintf(stderr,\"{%d - %d}\",offset,length);\u003c/span\u003e\n          \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;i \u0026#x3C; length;i++){\n            tail[i] = ((\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e*)(tail - offset))[i];\n          }\n          tail += length;\n          pt += \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n        }\n      }\n      fwrite(ori_buf,\u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e),ori_size,out);\n    }\n\n    \u003cspan class=\"hljs-built_in\"\u003efree\u003c/span\u003e(ori_buf);\n  }\n\n  \u003cspan class=\"hljs-built_in\"\u003efree\u003c/span\u003e(nbuf);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"算法分析\"\u003e算法分析\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#算法分析\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e在分析此算法压缩的数据效率如何时，可以看到和数据的内容有关，若重复率比较高，而且间隔距离短的内容，可以得到比较理想的压缩率，但是对于重复率低的内容就不一定能达到理想的压缩率，最差的情况就是，要压缩的内容刚刚好在滑动窗口大小的缓存都没有重复内容，那么压缩出来的数据不仅没有变小，而且增大到原来的3倍。\u003c/p\u003e\n\u003cp\u003e下图中的数据可以看到前面部分的非重复的数据就有许多的\u003ccode\u003e\"\\0x00\\0x00\"\u003c/code\u003e开头的直译复制过来的数据，这种数据过多就会导致压缩效率低下。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lz77compalgo/0ae608b93872.png\" alt=\"hexdat\"\u003e\u003c/p\u003e\n\u003cp\u003e一般来说，用LZ77算法压缩过的数据，为了抵消上面的劣势，可以将用LZ77压缩的数据再用哈夫曼编码再次编码，这样输出的数据压缩效率就高一些了。\u003c/p\u003e\n\u003cp\u003e链接：\u003ca href=\"https://github.com/hchen90/lz77\"\u003eGithub上的代码\u003c/a\u003e\u003c/p\u003e"])</script><script>self.__next_f.push([1,"7:[\"$\",\"$L15\",null,{\"postData\":{\"id\":\"lz77compalgo\",\"contentHtml\":\"$16\",\"title\":\"LZ77压缩算法\",\"date\":\"$D2018-03-31T20:38:24.000Z\",\"updated\":\"$D2018-03-31T20:38:24.000Z\",\"categories\":[\"算法\"],\"tags\":[\"lz77\",\"algorithm\"]}}]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"14:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"LZ77压缩算法\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"HCHEN90 博客\"}],[\"$\",\"link\",\"2\",{\"rel\":\"alternate\",\"type\":\"application/atom+xml\",\"href\":\"https://hchen90.top/atom.xml\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]],\"error\":null,\"digest\":\"$undefined\"}\ne:{\"metadata\":\"$14:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>