<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/283bb1ed86b49fd2.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/09ec4099fb721b31.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/09dfadb69bdaa005.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/54b9acc791aa599c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-ede82f7d0ae11dac.js"/><script src="/_next/static/chunks/4bd1b696-299743f5624cdabe.js" async=""></script><script src="/_next/static/chunks/684-481501000630d05e.js" async=""></script><script src="/_next/static/chunks/main-app-eb9456c5a3bb7ef4.js" async=""></script><script src="/_next/static/chunks/766-f505dbd3efffaa4c.js" async=""></script><script src="/_next/static/chunks/226-13d4d3f1fc18ceb6.js" async=""></script><script src="/_next/static/chunks/app/layout-bc83bfd6141341e7.js" async=""></script><script src="/_next/static/chunks/874-e909718850e7282e.js" async=""></script><script src="/_next/static/chunks/734-02ba314a893e68e9.js" async=""></script><script src="/_next/static/chunks/351-7dd07b3f065cc09a.js" async=""></script><script src="/_next/static/chunks/app/post/%5Bid%5D/page-871a46f82159f9c4.js" async=""></script><title>LZSS压缩算法</title><meta name="description" content="HCHEN90 博客"/><link rel="alternate" type="application/atom+xml" href="https://hchen90.top/atom.xml"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="antialiased relative"><div class="fixed top-4 right-4 z-50"><a href="https://github.com/hchen90" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow duration-300" title="Visit my GitHub profile"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></div><div class="min-h-screen relative"><div class="fixed top-0 left-0 h-1 bg-blue-500 z-50 transition-all duration-300" style="width:0%"></div><button class="fixed bottom-24 right-8 p-3 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg transition-opacity duration-300 z-50 opacity-0 pointer-events-none" aria-label="Back to top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"></path></svg></button><div class="main-content transition-all duration-300"><div class="max-w-4xl mx-auto px-4 py-8"><div class="mb-8"><a class="text-blue-500 hover:underline mb-4 inline-block" href="/">← 返回首页</a></div><article><header class="mb-8"><h1 class="text-4xl font-bold mb-4">LZSS压缩算法</h1><div class="text-gray-500 mb-4">2018年4月2日</div></header><div class="markdown-content"><h1 id="lzss算法简介">LZSS算法简介<a aria-hidden="true" tabindex="-1" href="#lzss算法简介"><span class="anchor-link"> #</span></a></h1>
<p>LZSS算法是LZ77算法的改良版，由James A. Storer和Thomas Szymacski于1982年发表在ACM杂志上。LZSS算法充分地利用了位的标记，从而使得压缩效率相比较于LZ77而言，有了显著提高。</p>
<blockquote>
<p>参考维基百科<a href="https://en.wikipedia.org/wiki/Lempel%E2%80%93Ziv%E2%80%93Storer%E2%80%93Szymanski">lzss</a></p>
</blockquote>
<h1 id="算法逻辑">算法逻辑<a aria-hidden="true" tabindex="-1" href="#算法逻辑"><span class="anchor-link"> #</span></a></h1>
<p>在看本篇博文之前，需要知道LZ77算法的大体流程，如果不清楚可以点击<a href="/2018/03/31/lz77compalgo">这里</a>浏览。</p>
<p>LZSS算法和LZ77算法的编码/解码流程逻辑是一致的，区别在于数据编码标记上，这里详细叙述一下LZSS的数据编码标记，可以看到它这种方式是如何显著提高压缩效率的。</p>
<p>在LZSS算法的数据编码里面有一个重要概念，就是：数据分组。</p>
<p>一个字节由8位组成，因此可以用一个字节来标记后面的至少8字节是否存在压缩编码，而不用<code>\0x00\0x00</code>的前缀来区分是否被压缩，从而节省了大量的<code>\0x00\0x00</code>前缀空间开销。</p>
<p>数据分组标记方式：</p>
<p><img src="/post/lzsscompalgo/9c651b397128.png" alt="databits"></p>
<blockquote>
<p>由此看见，这种数据分组的方式，最坏的情况下，只会每8个字节增加一个字节的额外空间开销，比起每个字节另外需要2个字节的空间开销而言，效率大幅提升。</p>
</blockquote>
<h1 id="源码实现">源码实现<a aria-hidden="true" tabindex="-1" href="#源码实现"><span class="anchor-link"> #</span></a></h1>
<p>辅助函数：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">c</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">search_maxlen_p</span><span class="hljs-params">( <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>**  pt, \
                              <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* head, \
                              <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* tail, \
                              <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* end)</span>
{
  <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* tmp = *pt;
  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> leng = <span class="hljs-number">0</span>, i;

  <span class="hljs-keyword">for</span>(tmp;tmp >= head;tmp--){
    <span class="hljs-keyword">if</span>(tmp[<span class="hljs-number">0</span>] == tail[<span class="hljs-number">0</span>]){
      <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>;(i &#x3C; ((<span class="hljs-number">1</span> &#x3C;&#x3C; LENGTHBITS) + <span class="hljs-number">1</span>)) &#x26;&#x26; (&#x26;tmp[i] > head) &#x26;&#x26; (&#x26;tmp[i] &#x3C; tail) &#x26;&#x26; (&#x26;tail[i] &#x3C; end) &#x26;&#x26; (tmp[i] == tail[i]);i++);
      <span class="hljs-keyword">if</span>(i > leng){
        leng = i;
        *pt = tmp;
      }
    }
  }
  <span class="hljs-keyword">return</span> leng;
}
</code></pre></div>
<p>编码实现：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">c</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">lzss_encode</span><span class="hljs-params">(FILE* in,FILE* out)</span>
{
  <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* buf = <span class="hljs-number">0</span>,* head = <span class="hljs-number">0</span>,* tail = <span class="hljs-number">0</span>;
  <span class="hljs-type">long</span> size = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">if</span>(! in || ! out)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  get_filesize(in,size);
  <span class="hljs-keyword">if</span>(size &#x3C;= <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  buf = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(size* <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>));
  <span class="hljs-keyword">if</span>(! buf)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  <span class="hljs-keyword">if</span>(fread(buf,<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>),size,in) == size){
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>  np      =  <span class="hljs-number">1</span> ,control_count = <span class="hljs-number">0</span>;
    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> suf[<span class="hljs-number">17</span>] = {<span class="hljs-number">0</span>}; <span class="hljs-comment">// 2*8 + 1</span>

    fputc((size >> <span class="hljs-number">24</span>) &#x26; <span class="hljs-number">0xff</span>,out);
    fputc((size >> <span class="hljs-number">16</span>) &#x26; <span class="hljs-number">0xff</span>,out);
    fputc((size >>  <span class="hljs-number">8</span>) &#x26; <span class="hljs-number">0xff</span>,out);
    fputc((size >>  <span class="hljs-number">0</span>) &#x26; <span class="hljs-number">0xff</span>,out);

    head = tail = buf;

    <span class="hljs-keyword">for</span>(;;){
      head = tail - WINDOWSIZE;
      <span class="hljs-keyword">if</span>(head &#x3C; buf)head = buf;

      <span class="hljs-keyword">if</span>(control_count >= <span class="hljs-number">8</span>){
        put_bytes(suf,np,out);
        <span class="hljs-built_in">memset</span>(suf,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(suf));
        np = <span class="hljs-number">1</span>;
        control_count = <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {
        control_count++;
      }

      <span class="hljs-keyword">if</span>(tail > buf + size - <span class="hljs-number">1</span>)<span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">if</span>(head &#x3C; tail){
        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> bytes = <span class="hljs-number">0</span>;
        <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* pt = tail - <span class="hljs-number">1</span>;
        bytes = search_maxlen_p(&#x26;pt,head,tail,buf + size);
        <span class="hljs-keyword">if</span>(bytes > <span class="hljs-number">2</span>){ <span class="hljs-comment">// if find a pattern more than 2 bytes, save its offset-length.</span>
          suf[<span class="hljs-number">0</span>]  &#x3C;&#x3C;= <span class="hljs-number">1</span>;
          suf[<span class="hljs-number">0</span>]   |= OFFLENFLAG;
          suf[np++] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)(( (tail - pt) >> LENGTHBITS) &#x26; <span class="hljs-number">0xff</span>);
          suf[np++] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)((((tail - pt) &#x3C;&#x3C; LENGTHBITS) + bytes - <span class="hljs-number">2</span>) &#x26; <span class="hljs-number">0xff</span>);
          tail += bytes;
        } <span class="hljs-keyword">else</span> {
          suf[<span class="hljs-number">0</span>]  &#x3C;&#x3C;= <span class="hljs-number">1</span>;
          suf[np++] = tail[<span class="hljs-number">0</span>];
          tail++;
        }
      } <span class="hljs-keyword">else</span> {
        suf[<span class="hljs-number">0</span>]  &#x3C;&#x3C;= <span class="hljs-number">1</span>;
        suf[np++] = tail[<span class="hljs-number">0</span>];
        tail++;
      }

    }

    <span class="hljs-keyword">for</span>(control_count;control_count &#x3C;= <span class="hljs-number">8</span>;control_count++)suf[<span class="hljs-number">0</span>] &#x3C;&#x3C;= <span class="hljs-number">1</span>; <span class="hljs-comment">// must keep highest bit is aligned to first byte.</span>
    put_bytes(suf,np,out);
  }

  <span class="hljs-built_in">free</span>(buf);

  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre></div>
<p>解码实现：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">c</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-c"><span class="hljs-type">int</span> <span class="hljs-title function_">lzss_decode</span><span class="hljs-params">(FILE* in,FILE* out)</span>
{
  <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* in_buffer = <span class="hljs-number">0</span>,* out_buffer = <span class="hljs-number">0</span>,* head = <span class="hljs-number">0</span>,* tail = <span class="hljs-number">0</span>;
  <span class="hljs-type">long</span> in_size = <span class="hljs-number">0</span>,out_size = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">if</span>(! in || ! out)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  get_filesize(in,in_size);
  <span class="hljs-keyword">if</span>(in_size &#x3C;= <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  out_size  = (fgetc(in) &#x26; <span class="hljs-number">0xff</span>) &#x3C;&#x3C; <span class="hljs-number">24</span>;
  out_size += (fgetc(in) &#x26; <span class="hljs-number">0xff</span>) &#x3C;&#x3C; <span class="hljs-number">16</span>;
  out_size += (fgetc(in) &#x26; <span class="hljs-number">0xff</span>) &#x3C;&#x3C;  <span class="hljs-number">8</span>;
  out_size += (fgetc(in) &#x26; <span class="hljs-number">0xff</span>) &#x3C;&#x3C;  <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span>(out_size &#x3C;= <span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  in_buffer = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)* in_size);
  <span class="hljs-keyword">if</span>(! in_buffer)<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

  out_buffer = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)* out_size);
  <span class="hljs-keyword">if</span>(out_buffer){
    <span class="hljs-keyword">if</span>(fread(in_buffer,<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>),in_size,in) == in_size - <span class="hljs-number">4</span>){
      <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>  control_count = <span class="hljs-number">0</span>;
      <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> control_flags = <span class="hljs-number">0</span>;
      <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*           pt = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)in_buffer;

      head  = tail  = out_buffer;
      control_flags = pt[<span class="hljs-number">0</span>];
      pt++;

      <span class="hljs-keyword">for</span>(;;){
        <span class="hljs-keyword">if</span>(pt >= (in_buffer + in_size - <span class="hljs-number">4</span>))<span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">if</span>(control_count >= <span class="hljs-number">8</span>){
          control_flags = pt[<span class="hljs-number">0</span>];
          pt++;
          control_count = <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> {
          control_count++;
        }

        <span class="hljs-keyword">if</span>(control_flags >> <span class="hljs-number">7</span>){ <span class="hljs-comment">// offset-length.</span>
          <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> offset = <span class="hljs-number">0</span>,length = <span class="hljs-number">0</span>,i;
          offset  =  pt[<span class="hljs-number">0</span>] &#x3C;&#x3C; LENGTHBITS;
          offset += (pt[<span class="hljs-number">1</span>] >> LENGTHBITS) &#x26; <span class="hljs-number">0x0f</span>;
          length  = (pt[<span class="hljs-number">1</span>] &#x26; <span class="hljs-number">0x0f</span>) + <span class="hljs-number">2</span>;
          <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>;i &#x3C; length;i++){
            tail[i] = ((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)(tail - offset))[i];
          }
          tail += length;
          pt += <span class="hljs-number">2</span>;
          control_flags &#x3C;&#x3C;= <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// literal.</span>
          tail[<span class="hljs-number">0</span>] = pt[<span class="hljs-number">0</span>];
          tail++;
          pt++;
          control_flags &#x3C;&#x3C;= <span class="hljs-number">1</span>;
        }
      }
      fwrite(out_buffer,<span class="hljs-keyword">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>),out_size,out);

    }
    <span class="hljs-built_in">free</span>(out_buffer);
  }

  <span class="hljs-built_in">free</span>(in_buffer);

  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre></div>
<h1 id="算法分析">算法分析<a aria-hidden="true" tabindex="-1" href="#算法分析"><span class="anchor-link"> #</span></a></h1>
<p>经过LZSS压缩的数据，已经算得上很不错的了，可见下图的十六进制展示：</p>
<p><img src="/post/lzsscompalgo/6db6b2ec019e.png" alt="hexdat"></p>
<p>但是，这里面的数据还有进一步空间优化，可以使用LZ77算法博文里面提到的哈夫曼编码进一步编码，就可以得到理想的压缩效果。</p>
<p>链接：<a href="https://github.com/hchen90/lzss">Github上的代码</a></p></div><div class="mt-12 pt-6 border-t border-gray-200 dark:border-gray-700"><a class="text-blue-500 hover:underline" href="/">← 返回所有文章列表</a></div><div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700 text-center text-gray-500 text-sm">© 2013 – 2025 陈祥</div></article></div></div></div><!--$--><!--/$--><!--$--><!--/$--><script src="/_next/static/chunks/webpack-ede82f7d0ae11dac.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7555,[],\"\"]\n3:I[1295,[],\"\"]\n4:I[415,[\"766\",\"static/chunks/766-f505dbd3efffaa4c.js\",\"226\",\"static/chunks/226-13d4d3f1fc18ceb6.js\",\"177\",\"static/chunks/app/layout-bc83bfd6141341e7.js\"],\"default\"]\n5:I[9243,[\"766\",\"static/chunks/766-f505dbd3efffaa4c.js\",\"226\",\"static/chunks/226-13d4d3f1fc18ceb6.js\",\"177\",\"static/chunks/app/layout-bc83bfd6141341e7.js\"],\"\"]\n8:I[9665,[],\"MetadataBoundary\"]\na:I[9665,[],\"OutletBoundary\"]\nd:I[4911,[],\"AsyncMetadataOutlet\"]\nf:I[9665,[],\"ViewportBoundary\"]\n11:I[6614,[],\"\"]\n:HL[\"/_next/static/css/283bb1ed86b49fd2.css\",\"style\"]\n:HL[\"/_next/static/css/09ec4099fb721b31.css\",\"style\"]\n:HL[\"/_next/static/css/09dfadb69bdaa005.css\",\"style\"]\n:HL[\"/_next/static/css/54b9acc791aa599c.css\",\"style\"]\n6:T4a2,\n          function copyCode(button) {\n            // Find the code element within the same wrapper\n            const codeWrapper = button.closest('.code-block-wrapper');\n            if (!codeWrapper) return;\n            \n            const codeElement = codeWrapper.querySelector('code');\n            if (!codeElement) return;\n            \n            // Get the text content\n            const text = codeElement.textContent;\n            \n            // Use the clipboard API to copy the text\n            navigator.clipboard.writeText(text).then(() =\u003e {\n              // Update the button state to show \"Copied!\"\n              button.setAttribute('data-copy-state', 'copied');\n              const buttonText = button.querySelector('.copy-button-text');\n              if (buttonText) buttonText.textContent = 'Copied!';\n              \n              // Reset after 2 seconds\n              setTimeout(() =\u003e {\n                button.setAttribute('data-copy-state', 'copy');\n                if (buttonText) buttonText.textContent = 'Copy';\n              }, 2000);\n            }).catch(err =\u003e {\n              console.error('Failed to copy text: ', err);\n            });\n          }\n          "])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"ZnA_pffjAXy0PvB3tEph0\",\"p\":\"\",\"c\":[\"\",\"post\",\"lzsscompalgo\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"post\",{\"children\":[[\"id\",\"lzsscompalgo\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/283bb1ed86b49fd2.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/09ec4099fb721b31.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/09dfadb69bdaa005.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"antialiased relative\",\"children\":[[\"$\",\"div\",null,{\"className\":\"fixed top-4 right-4 z-50\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/hchen90\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"flex items-center justify-center p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow duration-300\",\"title\":\"Visit my GitHub profile\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"24\",\"height\":\"24\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\"}]}]}]}],[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"$L4\",null,{}],[\"$\",\"$L5\",null,{\"id\":\"code-copy\",\"children\":\"$6\"}]]}]}]]}],{\"children\":[\"post\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"lzsscompalgo\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/54b9acc791aa599c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"WhyWenWzN-jQLpgTaELvu\",{\"children\":[[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$11\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"12:\"$Sreact.suspense\"\n13:I[4911,[],\"AsyncMetadata\"]\n9:[\"$\",\"$12\",null,{\"fallback\":null,\"children\":[\"$\",\"$L13\",null,{\"promise\":\"$@14\"}]}]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script><script>self.__next_f.push([1,"15:I[9543,[\"874\",\"static/chunks/874-e909718850e7282e.js\",\"734\",\"static/chunks/734-02ba314a893e68e9.js\",\"351\",\"static/chunks/351-7dd07b3f065cc09a.js\",\"457\",\"static/chunks/app/post/%5Bid%5D/page-871a46f82159f9c4.js\"],\"default\"]\n16:T3c25,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"lzss算法简介\"\u003eLZSS算法简介\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#lzss算法简介\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eLZSS算法是LZ77算法的改良版，由James A. Storer和Thomas Szymacski于1982年发表在ACM杂志上。LZSS算法充分地利用了位的标记，从而使得压缩效率相比较于LZ77而言，有了显著提高。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考维基百科\u003ca href=\"https://en.wikipedia.org/wiki/Lempel%E2%80%93Ziv%E2%80%93Storer%E2%80%93Szymanski\"\u003elzss\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"算法逻辑\"\u003e算法逻辑\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#算法逻辑\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e在看本篇博文之前，需要知道LZ77算法的大体流程，如果不清楚可以点击\u003ca href=\"/2018/03/31/lz77compalgo\"\u003e这里\u003c/a\u003e浏览。\u003c/p\u003e\n\u003cp\u003eLZSS算法和LZ77算法的编码/解码流程逻辑是一致的，区别在于数据编码标记上，这里详细叙述一下LZSS的数据编码标记，可以看到它这种方式是如何显著提高压缩效率的。\u003c/p\u003e\n\u003cp\u003e在LZSS算法的数据编码里面有一个重要概念，就是：数据分组。\u003c/p\u003e\n\u003cp\u003e一个字节由8位组成，因此可以用一个字节来标记后面的至少8字节是否存在压缩编码，而不用\u003ccode\u003e\\0x00\\0x00\u003c/code\u003e的前缀来区分是否被压缩，从而节省了大量的\u003ccode\u003e\\0x00\\0x00\u003c/code\u003e前缀空间开销。\u003c/p\u003e\n\u003cp\u003e数据分组标记方式：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lzsscompalgo/9c651b397128.png\" alt=\"databits\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e由此看见，这种数据分组的方式，最坏的情况下，只会每8个字节增加一个字节的额外空间开销，比起每个字节另外需要2个字节的空间开销而言，效率大幅提升。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"源码实现\"\u003e源码实现\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#源码实现\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e辅助函数：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ec\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c\"\u003e\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esearch_maxlen_p\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e( \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e**  pt, \\\n                              \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* head, \\\n                              \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* tail, \\\n                              \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* end)\u003c/span\u003e\n{\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* tmp = *pt;\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e leng = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, i;\n\n  \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(tmp;tmp \u003e= head;tmp--){\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(tmp[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] == tail[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]){\n      \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;(i \u0026#x3C; ((\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u0026#x3C;\u0026#x3C; LENGTHBITS) + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)) \u0026#x26;\u0026#x26; (\u0026#x26;tmp[i] \u003e head) \u0026#x26;\u0026#x26; (\u0026#x26;tmp[i] \u0026#x3C; tail) \u0026#x26;\u0026#x26; (\u0026#x26;tail[i] \u0026#x3C; end) \u0026#x26;\u0026#x26; (tmp[i] == tail[i]);i++);\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(i \u003e leng){\n        leng = i;\n        *pt = tmp;\n      }\n    }\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e leng;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e编码实现：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ec\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c\"\u003e\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003elzss_encode\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(FILE* in,FILE* out)\u003c/span\u003e\n{\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* buf = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,* head = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,* tail = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e size = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(! in || ! out)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  get_filesize(in,size);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(size \u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  buf = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e*)\u003cspan class=\"hljs-built_in\"\u003emalloc\u003c/span\u003e(size* \u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e));\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(! buf)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(fread(buf,\u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e),size,in) == size){\n    \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e  np      =  \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ,control_count = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e suf[\u003cspan class=\"hljs-number\"\u003e17\u003c/span\u003e] = {\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e}; \u003cspan class=\"hljs-comment\"\u003e// 2*8 + 1\u003c/span\u003e\n\n    fputc((size \u003e\u003e \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e,out);\n    fputc((size \u003e\u003e \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e,out);\n    fputc((size \u003e\u003e  \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e,out);\n    fputc((size \u003e\u003e  \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e,out);\n\n    head = tail = buf;\n\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(;;){\n      head = tail - WINDOWSIZE;\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(head \u0026#x3C; buf)head = buf;\n\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(control_count \u003e= \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e){\n        put_bytes(suf,np,out);\n        \u003cspan class=\"hljs-built_in\"\u003ememset\u003c/span\u003e(suf,\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(suf));\n        np = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        control_count = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        control_count++;\n      }\n\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(tail \u003e buf + size - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(head \u0026#x3C; tail){\n        \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e bytes = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* pt = tail - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        bytes = search_maxlen_p(\u0026#x26;pt,head,tail,buf + size);\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(bytes \u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e){ \u003cspan class=\"hljs-comment\"\u003e// if find a pattern more than 2 bytes, save its offset-length.\u003c/span\u003e\n          suf[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]  \u0026#x3C;\u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n          suf[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]   |= OFFLENFLAG;\n          suf[np++] = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e)(( (tail - pt) \u003e\u003e LENGTHBITS) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e);\n          suf[np++] = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e)((((tail - pt) \u0026#x3C;\u0026#x3C; LENGTHBITS) + bytes - \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e);\n          tail += bytes;\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n          suf[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]  \u0026#x3C;\u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n          suf[np++] = tail[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n          tail++;\n        }\n      } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        suf[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]  \u0026#x3C;\u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        suf[np++] = tail[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n        tail++;\n      }\n\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(control_count;control_count \u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e;control_count++)suf[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] \u0026#x3C;\u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// must keep highest bit is aligned to first byte.\u003c/span\u003e\n    put_bytes(suf,np,out);\n  }\n\n  \u003cspan class=\"hljs-built_in\"\u003efree\u003c/span\u003e(buf);\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e解码实现：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ec\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-c\"\u003e\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003elzss_decode\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(FILE* in,FILE* out)\u003c/span\u003e\n{\n  \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e* in_buffer = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,* out_buffer = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,* head = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,* tail = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e in_size = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,out_size = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(! in || ! out)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  get_filesize(in,in_size);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(in_size \u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  out_size  = (fgetc(in) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e) \u0026#x3C;\u0026#x3C; \u003cspan class=\"hljs-number\"\u003e24\u003c/span\u003e;\n  out_size += (fgetc(in) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e) \u0026#x3C;\u0026#x3C; \u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e;\n  out_size += (fgetc(in) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e) \u0026#x3C;\u0026#x3C;  \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e;\n  out_size += (fgetc(in) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0xff\u003c/span\u003e) \u0026#x3C;\u0026#x3C;  \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(out_size \u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  in_buffer = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e*)\u003cspan class=\"hljs-built_in\"\u003emalloc\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e)* in_size);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(! in_buffer)\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  out_buffer = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e*)\u003cspan class=\"hljs-built_in\"\u003emalloc\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e)* out_size);\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(out_buffer){\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(fread(in_buffer,\u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e),in_size,in) == in_size - \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e){\n      \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e  control_count = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n      \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e control_flags = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n      \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e*           pt = (\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e*)in_buffer;\n\n      head  = tail  = out_buffer;\n      control_flags = pt[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n      pt++;\n\n      \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(;;){\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(pt \u003e= (in_buffer + in_size - \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e))\u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(control_count \u003e= \u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e){\n          control_flags = pt[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n          pt++;\n          control_count = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n          control_count++;\n        }\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(control_flags \u003e\u003e \u003cspan class=\"hljs-number\"\u003e7\u003c/span\u003e){ \u003cspan class=\"hljs-comment\"\u003e// offset-length.\u003c/span\u003e\n          \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e offset = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,length = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,i;\n          offset  =  pt[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] \u0026#x3C;\u0026#x3C; LENGTHBITS;\n          offset += (pt[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] \u003e\u003e LENGTHBITS) \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0x0f\u003c/span\u003e;\n          length  = (pt[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] \u0026#x26; \u003cspan class=\"hljs-number\"\u003e0x0f\u003c/span\u003e) + \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n          \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;i \u0026#x3C; length;i++){\n            tail[i] = ((\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e*)(tail - offset))[i];\n          }\n          tail += length;\n          pt += \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n          control_flags \u0026#x3C;\u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e { \u003cspan class=\"hljs-comment\"\u003e// literal.\u003c/span\u003e\n          tail[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] = pt[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e];\n          tail++;\n          pt++;\n          control_flags \u0026#x3C;\u0026#x3C;= \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        }\n      }\n      fwrite(out_buffer,\u003cspan class=\"hljs-keyword\"\u003esizeof\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e),out_size,out);\n\n    }\n    \u003cspan class=\"hljs-built_in\"\u003efree\u003c/span\u003e(out_buffer);\n  }\n\n  \u003cspan class=\"hljs-built_in\"\u003efree\u003c/span\u003e(in_buffer);\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"算法分析\"\u003e算法分析\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#算法分析\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e经过LZSS压缩的数据，已经算得上很不错的了，可见下图的十六进制展示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/lzsscompalgo/6db6b2ec019e.png\" alt=\"hexdat\"\u003e\u003c/p\u003e\n\u003cp\u003e但是，这里面的数据还有进一步空间优化，可以使用LZ77算法博文里面提到的哈夫曼编码进一步编码，就可以得到理想的压缩效果。\u003c/p\u003e\n\u003cp\u003e链接：\u003ca href=\"https://github.com/hchen90/lzss\"\u003eGithub上的代码\u003c/a\u003e\u003c/p\u003e"])</script><script>self.__next_f.push([1,"7:[\"$\",\"$L15\",null,{\"postData\":{\"id\":\"lzsscompalgo\",\"contentHtml\":\"$16\",\"title\":\"LZSS压缩算法\",\"date\":\"$D2018-04-01T21:12:32.000Z\",\"updated\":\"$D2018-04-01T21:12:32.000Z\",\"categories\":[\"算法\"],\"tags\":[\"lzss\",\"algorithm\"]}}]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"14:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"LZSS压缩算法\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"HCHEN90 博客\"}],[\"$\",\"link\",\"2\",{\"rel\":\"alternate\",\"type\":\"application/atom+xml\",\"href\":\"https://hchen90.top/atom.xml\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]],\"error\":null,\"digest\":\"$undefined\"}\ne:{\"metadata\":\"$14:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>