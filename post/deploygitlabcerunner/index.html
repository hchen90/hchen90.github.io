<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/283bb1ed86b49fd2.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/09ec4099fb721b31.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/09dfadb69bdaa005.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/54b9acc791aa599c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-ede82f7d0ae11dac.js"/><script src="/_next/static/chunks/4bd1b696-299743f5624cdabe.js" async=""></script><script src="/_next/static/chunks/684-481501000630d05e.js" async=""></script><script src="/_next/static/chunks/main-app-eb9456c5a3bb7ef4.js" async=""></script><script src="/_next/static/chunks/766-f505dbd3efffaa4c.js" async=""></script><script src="/_next/static/chunks/226-13d4d3f1fc18ceb6.js" async=""></script><script src="/_next/static/chunks/app/layout-bc83bfd6141341e7.js" async=""></script><script src="/_next/static/chunks/874-e909718850e7282e.js" async=""></script><script src="/_next/static/chunks/734-02ba314a893e68e9.js" async=""></script><script src="/_next/static/chunks/351-7dd07b3f065cc09a.js" async=""></script><script src="/_next/static/chunks/app/post/%5Bid%5D/page-871a46f82159f9c4.js" async=""></script><title>玩转自搭建 GitLab 社区版</title><meta name="description" content="HCHEN90 博客"/><link rel="alternate" type="application/atom+xml" href="https://hchen90.top/atom.xml"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="antialiased relative"><div class="fixed top-4 right-4 z-50"><a href="https://github.com/hchen90" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow duration-300" title="Visit my GitHub profile"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></div><div class="min-h-screen relative"><div class="fixed top-0 left-0 h-1 bg-blue-500 z-50 transition-all duration-300" style="width:0%"></div><button class="fixed bottom-24 right-8 p-3 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg transition-opacity duration-300 z-50 opacity-0 pointer-events-none" aria-label="Back to top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"></path></svg></button><div class="main-content transition-all duration-300"><div class="max-w-4xl mx-auto px-4 py-8"><div class="mb-8"><a class="text-blue-500 hover:underline mb-4 inline-block" href="/">← 返回首页</a></div><article><header class="mb-8"><h1 class="text-4xl font-bold mb-4">玩转自搭建 GitLab 社区版</h1><div class="text-gray-500 mb-4">2022年7月2日</div></header><div class="markdown-content"><h1 id="玩转自搭建-gitlab-社区版">玩转自搭建 GitLab 社区版<a aria-hidden="true" tabindex="-1" href="#玩转自搭建-gitlab-社区版"><span class="anchor-link"> #</span></a></h1>
<p>本文的自搭建是基于docker容器技术而实现的，其中包括<code>gitlab-ce</code>和<code>gitlab-runner</code>两个部分。</p>
<h2 id="什么是-gitlab">什么是 GitLab<a aria-hidden="true" tabindex="-1" href="#什么是-gitlab"><span class="anchor-link"> #</span></a></h2>
<p><strong>GitLab</strong>是一个代码仓库管理系统（它是一套开源项目），使用 Git 作为代码管理工具，集成 Web 管理的服务，<strong>GitLab</strong>被广泛用于基于 Git 代码管理平台，在很多一些结构不是复杂的组织结构中都会优先使用它。</p>
<h2 id="它能做什么">它能做什么<a aria-hidden="true" tabindex="-1" href="#它能做什么"><span class="anchor-link"> #</span></a></h2>
<p><strong>GitLab</strong>是代码仓库管理系统，它实现了一个更加界面友好的交互方式来对项目代码进行管理，除此之外，它还可以集成CI/CD特性，通过部署 <strong>GitLab-Runner</strong> 来对项目代码进行持续集成和部署分发。</p>
<p>功能很实用，可以满足常规的项目开发工作。</p>
<blockquote>
<p>对比一些大项目，其设计复杂，对于代码的管控也非常复杂，采取的管理手段也多样化，GitLab可能不一定适应这种场景，为此大多数的做法是仓库管理系统和CI/CD系统分离的结构，仓库管理系统有五花八门的，有自己开发的（或者基于其他的开源项目），而对于CI/CD系统一般都是采用Jenkins，其有更加丰富的成熟套件和流程方案。</p>
</blockquote>
<h2 id="搭建步骤">搭建步骤<a aria-hidden="true" tabindex="-1" href="#搭建步骤"><span class="anchor-link"> #</span></a></h2>
<p>这里介绍我测试搭建这套系统的搭建步骤。</p>
<h3 id="搭建-gitlab-主框架">搭建 GitLab 主框架<a aria-hidden="true" tabindex="-1" href="#搭建-gitlab-主框架"><span class="anchor-link"> #</span></a></h3>
<p>在Docker镜像的主官网上，我们其实可以搜索到<strong>GitLab</strong>的镜像，所以我们很方便的使用Docker技术来部署我们需要的服务。</p>
<p><img src="/post/deploygitlabcerunner/530bd021d4e1.png" alt="docker-gitlab-ce"></p>
<p>该镜像下有很多的<code>tags</code>，可以指定特定的版本，或者使用默认的最近版本。</p>
<p><strong>GitLab</strong>的管理系统搭建，我使用编写<code>docker-compose.yml</code>方式来部署的，注意添加服务的时候，设置的环境变量<code>GITLAB_OMNIBUS_CONFIG</code>，可以为服务启动传递启动参数。</p>
<p>当仓库管理系统服务创建并启动后，我们就可以打开浏览器来访问自搭建部署的<strong>GitLab</strong>服务了，如下图所示：</p>
<p><img src="/post/deploygitlabcerunner/e2e1519d6a0e.png" alt="login"></p>
<h3 id="登录管理员账号">登录管理员账号<a aria-hidden="true" tabindex="-1" href="#登录管理员账号"><span class="anchor-link"> #</span></a></h3>
<p>以上步骤之后，需要登录管理员的账号，来进一步对系统进行配置，管理员的用户名是<code>root</code>，而密码需要从容器里面去获取，我们也可以获取容器的IP，便于后面的设置使用，如下：</p>
<p><img src="/post/deploygitlabcerunner/9442444b2afa.png" alt="gitlab-ce-info"></p>
<p>据此我们得到管理员的密码来登录系统。</p>
<p><img src="/post/deploygitlabcerunner/1c87025556eb.png" alt="admin-dashboard"></p>
<p>系统登录后进入系统配置的页面，在此页面上，我们可以完成仓库管理系统的所有配置工作。</p>
<blockquote>
<p>我们弄这个GitLab绝对不是仅仅作为代码管理系统而用的，如果仅仅为了代码仓库管理，可以移步到<code>gogs</code>这些代码仓库管理系统，它速度快，简洁而且美观，很有Github的界面感。</p>
</blockquote>
<h4 id="cicd环境部署配置">CI/CD环境部署配置<a aria-hidden="true" tabindex="-1" href="#cicd环境部署配置"><span class="anchor-link"> #</span></a></h4>
<p>这是配置的重头戏了。</p>
<p>当上面的步骤都差不多了，就要进行<strong>GitLab-Runner</strong>的部署，它是CI/CD的代理节点，我们可以在管理员界面下点开<strong>Runner</strong>查看可以用的列表：</p>
<p><img src="/post/deploygitlabcerunner/f6e0f2e2f440.png" alt="runners"></p>
<p>上面啥也没有，我们需要弄一个代理机器作为节点，让它去跑<strong>Runner</strong>，为此我们需要在代理机器上安装<strong>GitLab-Runner</strong>，这是常规操作。</p>
<p>但是，我只是测试一下GitLab的特性，把玩一下而已，所有不需要那么复杂，仍然可以通过部署Docker的<strong>GitLab-Runner</strong>服务的运行它，并把它注册到本地，这样为了便于解析IP，我需要调整一下Hosts文件的内容，增加一行解析：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">vbnet</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-vbnet"><span class="hljs-number">192.168</span>.<span class="hljs-number">176.2</span> gitlab.<span class="hljs-keyword">me</span>
</code></pre></div>
<p>上面的<code>192.168.176.2</code>，不一定和你的一样，需要和上面的容器内的IP对应，这样多个容器都可以正确解析到正确的IP上去。</p>
<p>下面是注册 Runner （这里的<code>token</code>可以从上图的<code>Registration token</code>处复制过来），如图所示：</p>
<p><img src="/post/deploygitlabcerunner/53a51f2560c9.png" alt="runner-register"></p>
<p>注册成功后，会在上面的Runners列表里面刷新出来。</p>
<blockquote>
<p>注意到，我这里的<code>executor</code>用的是<code>docker</code>，这样我可以用Docker镜像（gcc）来编译代码，这适合这种用Docker容器部署的情形，但是如果是直接把Runner安装在了实体机器上的，并且实体机器上已经存在开发环境，那么我们可以直接用<code>shell</code>方式来编译。如果是需要在代理节点上再次ssh登录远程机器来编译代码，那么<code>executor</code>就应该选用<code>ssh</code>的方式。具体使用哪种方式取决于实际环境。</p>
</blockquote>
<p>注册成功后，在 <strong>Runners</strong> 列表刷新出刚刚新加的<strong>Runner</strong>，如下图：</p>
<p><img src="/post/deploygitlabcerunner/d954e9363c1c.png" alt="runner-list"></p>
<p>上图中，点击左边的链接可以看到 <strong>Runner</strong> 的详情：</p>
<p><img src="/post/deploygitlabcerunner/1e90dd45eba5.png" alt="runner-details"></p>
<p>点击右边的铅笔，可以修改Runner的参数设定：</p>
<p><img src="/post/deploygitlabcerunner/5329eafbdd66.png" alt="runner-enable-untag"></p>
<p>这里我把<code>Run untagged jobs</code>复选框勾上，并保存修改。</p>
<p>到这里整个<strong>Runner</strong>的配置基本就完成了。</p>
<blockquote>
<p>Runner还有更多的配置，详情可以参考官方文档介绍。</p>
</blockquote>
<h3 id="创建普通用户帐号">创建普通用户帐号<a aria-hidden="true" tabindex="-1" href="#创建普通用户帐号"><span class="anchor-link"> #</span></a></h3>
<p>接着我们打开一个隐私页面，进入登录界面，这次我们点击<code>Register now</code>来新建用户，填写完用户信息后，注册一个新的用户，然后需要管理员在用户管理界面上进行批准，批准通过后，刚注册的用户就可以正常登录系统了，如下图（图中的用户已经新建了一个仓库）：</p>
<p><img src="/post/deploygitlabcerunner/279ae5d2774b.png" alt="user-projects"></p>
<p>该普通用户帐户是开发者，后面测试CI/CD系统将以该用户进行测试。</p>
<h4 id="创建仓库">创建仓库<a aria-hidden="true" tabindex="-1" href="#创建仓库"><span class="anchor-link"> #</span></a></h4>
<p>新建仓库非常简单，只需点击<code>New project</code>后，填写项目基本信息即可：</p>
<p><img src="/post/deploygitlabcerunner/e89af7df63df.png" alt="new-project"></p>
<h4 id="设置仓库的-gitlab-ci">设置仓库的 gitlab-ci<a aria-hidden="true" tabindex="-1" href="#设置仓库的-gitlab-ci"><span class="anchor-link"> #</span></a></h4>
<p>设置仓库根目录下的<code>.gitlab-ci.yml</code>文件，添加流水线任务。</p>
<p>我写的非常简单，<code>script</code>指定编译命令，<code>only</code>指定在哪一个分支下进行CI部署（我指定的是：main分支），然后<code>tags</code>和注册<strong>Runner</strong>的<code>tags</code>一一对应的。</p>
<blockquote>
<p>关于<code>gitlab-ci.yml</code>文件的更多细节可以参考<a href="https://docs.gitlab.com/ee/ci/yaml/gitlab_ci_yaml.html">官方文档</a>。</p>
</blockquote>
<h4 id="提交代码并进行-ci-操作">提交代码并进行 CI 操作<a aria-hidden="true" tabindex="-1" href="#提交代码并进行-ci-操作"><span class="anchor-link"> #</span></a></h4>
<p>当一切都准备妥当后，下面就是写代码，并提交到远程仓库的main分支下：</p>
<p><img src="/post/deploygitlabcerunner/fc979b40e6df.png" alt="git-push"></p>
<p>刚提交了代码，系统上立即显示流水线就已经在更新了。</p>
<p><img src="/post/deploygitlabcerunner/94be700a77c7.png" alt="pipelines"></p>
<p>可以点开正在执行的流水，查看任务细节：</p>
<p><img src="/post/deploygitlabcerunner/121b5fa098bf.png" alt="pipeline-success"></p>
<p>至此，这个<strong>GitLab</strong>的基本配置，和它的CI/CD流水配置，以及使用也已经完成，这套代码管理系统的实用性，总体来说还算不错的。</p>
<h2 id="具体配置">具体配置<a aria-hidden="true" tabindex="-1" href="#具体配置"><span class="anchor-link"> #</span></a></h2>
<p>以下两个文件是我的测试配置，仅供参考。</p>
<h3 id="我的测试配置">我的测试配置<a aria-hidden="true" tabindex="-1" href="#我的测试配置"><span class="anchor-link"> #</span></a></h3>
<p><code>.gitlab-ci.yml</code>配置如下：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">yaml</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-yaml"><span class="hljs-attr">stages:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">build</span>

<span class="hljs-attr">build source:</span>
  <span class="hljs-attr">stage:</span> <span class="hljs-string">build</span>
  <span class="hljs-attr">tags:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">linux</span>
  <span class="hljs-attr">script:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">gcc</span> <span class="hljs-string">-o</span> <span class="hljs-string">main</span> <span class="hljs-string">main.c</span>
  <span class="hljs-attr">only:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">main</span>
  <span class="hljs-attr">interruptible:</span> <span class="hljs-literal">true</span>
</code></pre></div>
<p><code>docker-compose.yml</code>配置如下：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">yaml</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.0"</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">gitlab-web:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">gitlab/gitlab-ce</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">hostname:</span> <span class="hljs-string">'gitlab.me'</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">GITLAB_OMNIBUS_CONFIG:</span> <span class="hljs-string">|
        external_url 'http://gitlab.me:2080/'
</span>    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'2080:2080'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'2443:443'</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./gitlab/config:/etc/gitlab</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./gitlab/logs:/var/log/gitlab</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./gitlab/data:/var/opt/gitlab</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">gitlab</span>

  <span class="hljs-attr">gitlab-runner:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">gitlab/gitlab-runner:alpine</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">gitlab-web</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./gitlab/gitlab-runner:/etc/gitlab-runner</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">gitlab</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">gitlab:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">gitlab-network</span>

</code></pre></div>
<h3 id="我遇到的坑">我遇到的坑<a aria-hidden="true" tabindex="-1" href="#我遇到的坑"><span class="anchor-link"> #</span></a></h3>
<blockquote>
<p>可能会碰到的坑：</p>
<ol>
<li><code>docker-compose.yml</code>文件中设置环境变量<code>GITLAB_OMNIBUS_CONFIG</code>中的<code>external_url</code>，如果域名带端口，docker的服务监听会绑定到该端口上；</li>
<li><code>gitlab-runner</code>的配置（config.toml），<code>runner.docker</code>节区下添加<code>network_mode</code>为<code>gitlab-network</code>以对应<code>docker-compose.yml</code></li>
</ol>
</blockquote>
<h2 id="链接">链接<a aria-hidden="true" tabindex="-1" href="#链接"><span class="anchor-link"> #</span></a></h2>
<p><a href="https://www.czerniga.it/2021/11/14/how-to-install-gitlab-using-docker-compose/">how-to-install-gitlab-using-docker-compose</a></p></div><div class="mt-12 pt-6 border-t border-gray-200 dark:border-gray-700"><a class="text-blue-500 hover:underline" href="/">← 返回所有文章列表</a></div><div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700 text-center text-gray-500 text-sm">© 2013 – 2025 陈祥</div></article></div></div></div><!--$--><!--/$--><!--$--><!--/$--><script src="/_next/static/chunks/webpack-ede82f7d0ae11dac.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7555,[],\"\"]\n3:I[1295,[],\"\"]\n4:I[415,[\"766\",\"static/chunks/766-f505dbd3efffaa4c.js\",\"226\",\"static/chunks/226-13d4d3f1fc18ceb6.js\",\"177\",\"static/chunks/app/layout-bc83bfd6141341e7.js\"],\"default\"]\n5:I[9243,[\"766\",\"static/chunks/766-f505dbd3efffaa4c.js\",\"226\",\"static/chunks/226-13d4d3f1fc18ceb6.js\",\"177\",\"static/chunks/app/layout-bc83bfd6141341e7.js\"],\"\"]\n8:I[9665,[],\"MetadataBoundary\"]\na:I[9665,[],\"OutletBoundary\"]\nd:I[4911,[],\"AsyncMetadataOutlet\"]\nf:I[9665,[],\"ViewportBoundary\"]\n11:I[6614,[],\"\"]\n:HL[\"/_next/static/css/283bb1ed86b49fd2.css\",\"style\"]\n:HL[\"/_next/static/css/09ec4099fb721b31.css\",\"style\"]\n:HL[\"/_next/static/css/09dfadb69bdaa005.css\",\"style\"]\n:HL[\"/_next/static/css/54b9acc791aa599c.css\",\"style\"]\n6:T4a2,\n          function copyCode(button) {\n            // Find the code element within the same wrapper\n            const codeWrapper = button.closest('.code-block-wrapper');\n            if (!codeWrapper) return;\n            \n            const codeElement = codeWrapper.querySelector('code');\n            if (!codeElement) return;\n            \n            // Get the text content\n            const text = codeElement.textContent;\n            \n            // Use the clipboard API to copy the text\n            navigator.clipboard.writeText(text).then(() =\u003e {\n              // Update the button state to show \"Copied!\"\n              button.setAttribute('data-copy-state', 'copied');\n              const buttonText = button.querySelector('.copy-button-text');\n              if (buttonText) buttonText.textContent = 'Copied!';\n              \n              // Reset after 2 seconds\n              setTimeout(() =\u003e {\n                button.setAttribute('data-copy-state', 'copy');\n                if (buttonText) buttonText.textContent = 'Copy';\n              }, 2000);\n            }).catch(err =\u003e {\n              console.error('Failed to copy text: ', err);\n            });\n          }\n          "])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"ZnA_pffjAXy0PvB3tEph0\",\"p\":\"\",\"c\":[\"\",\"post\",\"deploygitlabcerunner\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"post\",{\"children\":[[\"id\",\"deploygitlabcerunner\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/283bb1ed86b49fd2.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/09ec4099fb721b31.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/09dfadb69bdaa005.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"antialiased relative\",\"children\":[[\"$\",\"div\",null,{\"className\":\"fixed top-4 right-4 z-50\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/hchen90\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"flex items-center justify-center p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow duration-300\",\"title\":\"Visit my GitHub profile\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"24\",\"height\":\"24\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\"}]}]}]}],[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"$L4\",null,{}],[\"$\",\"$L5\",null,{\"id\":\"code-copy\",\"children\":\"$6\"}]]}]}]]}],{\"children\":[\"post\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"deploygitlabcerunner\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/54b9acc791aa599c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"PuA4jbcl-4jJzQKxYLo92\",{\"children\":[[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$11\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"12:\"$Sreact.suspense\"\n13:I[4911,[],\"AsyncMetadata\"]\n9:[\"$\",\"$12\",null,{\"fallback\":null,\"children\":[\"$\",\"$L13\",null,{\"promise\":\"$@14\"}]}]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script><script>self.__next_f.push([1,"15:I[9543,[\"874\",\"static/chunks/874-e909718850e7282e.js\",\"734\",\"static/chunks/734-02ba314a893e68e9.js\",\"351\",\"static/chunks/351-7dd07b3f065cc09a.js\",\"457\",\"static/chunks/app/post/%5Bid%5D/page-871a46f82159f9c4.js\"],\"default\"]\n16:T3b3c,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"玩转自搭建-gitlab-社区版\"\u003e玩转自搭建 GitLab 社区版\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#玩转自搭建-gitlab-社区版\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e本文的自搭建是基于docker容器技术而实现的，其中包括\u003ccode\u003egitlab-ce\u003c/code\u003e和\u003ccode\u003egitlab-runner\u003c/code\u003e两个部分。\u003c/p\u003e\n\u003ch2 id=\"什么是-gitlab\"\u003e什么是 GitLab\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#什么是-gitlab\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eGitLab\u003c/strong\u003e是一个代码仓库管理系统（它是一套开源项目），使用 Git 作为代码管理工具，集成 Web 管理的服务，\u003cstrong\u003eGitLab\u003c/strong\u003e被广泛用于基于 Git 代码管理平台，在很多一些结构不是复杂的组织结构中都会优先使用它。\u003c/p\u003e\n\u003ch2 id=\"它能做什么\"\u003e它能做什么\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#它能做什么\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eGitLab\u003c/strong\u003e是代码仓库管理系统，它实现了一个更加界面友好的交互方式来对项目代码进行管理，除此之外，它还可以集成CI/CD特性，通过部署 \u003cstrong\u003eGitLab-Runner\u003c/strong\u003e 来对项目代码进行持续集成和部署分发。\u003c/p\u003e\n\u003cp\u003e功能很实用，可以满足常规的项目开发工作。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e对比一些大项目，其设计复杂，对于代码的管控也非常复杂，采取的管理手段也多样化，GitLab可能不一定适应这种场景，为此大多数的做法是仓库管理系统和CI/CD系统分离的结构，仓库管理系统有五花八门的，有自己开发的（或者基于其他的开源项目），而对于CI/CD系统一般都是采用Jenkins，其有更加丰富的成熟套件和流程方案。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"搭建步骤\"\u003e搭建步骤\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#搭建步骤\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e这里介绍我测试搭建这套系统的搭建步骤。\u003c/p\u003e\n\u003ch3 id=\"搭建-gitlab-主框架\"\u003e搭建 GitLab 主框架\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#搭建-gitlab-主框架\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e在Docker镜像的主官网上，我们其实可以搜索到\u003cstrong\u003eGitLab\u003c/strong\u003e的镜像，所以我们很方便的使用Docker技术来部署我们需要的服务。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/530bd021d4e1.png\" alt=\"docker-gitlab-ce\"\u003e\u003c/p\u003e\n\u003cp\u003e该镜像下有很多的\u003ccode\u003etags\u003c/code\u003e，可以指定特定的版本，或者使用默认的最近版本。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eGitLab\u003c/strong\u003e的管理系统搭建，我使用编写\u003ccode\u003edocker-compose.yml\u003c/code\u003e方式来部署的，注意添加服务的时候，设置的环境变量\u003ccode\u003eGITLAB_OMNIBUS_CONFIG\u003c/code\u003e，可以为服务启动传递启动参数。\u003c/p\u003e\n\u003cp\u003e当仓库管理系统服务创建并启动后，我们就可以打开浏览器来访问自搭建部署的\u003cstrong\u003eGitLab\u003c/strong\u003e服务了，如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/e2e1519d6a0e.png\" alt=\"login\"\u003e\u003c/p\u003e\n\u003ch3 id=\"登录管理员账号\"\u003e登录管理员账号\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#登录管理员账号\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e以上步骤之后，需要登录管理员的账号，来进一步对系统进行配置，管理员的用户名是\u003ccode\u003eroot\u003c/code\u003e，而密码需要从容器里面去获取，我们也可以获取容器的IP，便于后面的设置使用，如下：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/9442444b2afa.png\" alt=\"gitlab-ce-info\"\u003e\u003c/p\u003e\n\u003cp\u003e据此我们得到管理员的密码来登录系统。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/1c87025556eb.png\" alt=\"admin-dashboard\"\u003e\u003c/p\u003e\n\u003cp\u003e系统登录后进入系统配置的页面，在此页面上，我们可以完成仓库管理系统的所有配置工作。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e我们弄这个GitLab绝对不是仅仅作为代码管理系统而用的，如果仅仅为了代码仓库管理，可以移步到\u003ccode\u003egogs\u003c/code\u003e这些代码仓库管理系统，它速度快，简洁而且美观，很有Github的界面感。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"cicd环境部署配置\"\u003eCI/CD环境部署配置\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#cicd环境部署配置\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e这是配置的重头戏了。\u003c/p\u003e\n\u003cp\u003e当上面的步骤都差不多了，就要进行\u003cstrong\u003eGitLab-Runner\u003c/strong\u003e的部署，它是CI/CD的代理节点，我们可以在管理员界面下点开\u003cstrong\u003eRunner\u003c/strong\u003e查看可以用的列表：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/f6e0f2e2f440.png\" alt=\"runners\"\u003e\u003c/p\u003e\n\u003cp\u003e上面啥也没有，我们需要弄一个代理机器作为节点，让它去跑\u003cstrong\u003eRunner\u003c/strong\u003e，为此我们需要在代理机器上安装\u003cstrong\u003eGitLab-Runner\u003c/strong\u003e，这是常规操作。\u003c/p\u003e\n\u003cp\u003e但是，我只是测试一下GitLab的特性，把玩一下而已，所有不需要那么复杂，仍然可以通过部署Docker的\u003cstrong\u003eGitLab-Runner\u003c/strong\u003e服务的运行它，并把它注册到本地，这样为了便于解析IP，我需要调整一下Hosts文件的内容，增加一行解析：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003evbnet\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-vbnet\"\u003e\u003cspan class=\"hljs-number\"\u003e192.168\u003c/span\u003e.\u003cspan class=\"hljs-number\"\u003e176.2\u003c/span\u003e gitlab.\u003cspan class=\"hljs-keyword\"\u003eme\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e上面的\u003ccode\u003e192.168.176.2\u003c/code\u003e，不一定和你的一样，需要和上面的容器内的IP对应，这样多个容器都可以正确解析到正确的IP上去。\u003c/p\u003e\n\u003cp\u003e下面是注册 Runner （这里的\u003ccode\u003etoken\u003c/code\u003e可以从上图的\u003ccode\u003eRegistration token\u003c/code\u003e处复制过来），如图所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/53a51f2560c9.png\" alt=\"runner-register\"\u003e\u003c/p\u003e\n\u003cp\u003e注册成功后，会在上面的Runners列表里面刷新出来。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e注意到，我这里的\u003ccode\u003eexecutor\u003c/code\u003e用的是\u003ccode\u003edocker\u003c/code\u003e，这样我可以用Docker镜像（gcc）来编译代码，这适合这种用Docker容器部署的情形，但是如果是直接把Runner安装在了实体机器上的，并且实体机器上已经存在开发环境，那么我们可以直接用\u003ccode\u003eshell\u003c/code\u003e方式来编译。如果是需要在代理节点上再次ssh登录远程机器来编译代码，那么\u003ccode\u003eexecutor\u003c/code\u003e就应该选用\u003ccode\u003essh\u003c/code\u003e的方式。具体使用哪种方式取决于实际环境。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e注册成功后，在 \u003cstrong\u003eRunners\u003c/strong\u003e 列表刷新出刚刚新加的\u003cstrong\u003eRunner\u003c/strong\u003e，如下图：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/d954e9363c1c.png\" alt=\"runner-list\"\u003e\u003c/p\u003e\n\u003cp\u003e上图中，点击左边的链接可以看到 \u003cstrong\u003eRunner\u003c/strong\u003e 的详情：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/1e90dd45eba5.png\" alt=\"runner-details\"\u003e\u003c/p\u003e\n\u003cp\u003e点击右边的铅笔，可以修改Runner的参数设定：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/5329eafbdd66.png\" alt=\"runner-enable-untag\"\u003e\u003c/p\u003e\n\u003cp\u003e这里我把\u003ccode\u003eRun untagged jobs\u003c/code\u003e复选框勾上，并保存修改。\u003c/p\u003e\n\u003cp\u003e到这里整个\u003cstrong\u003eRunner\u003c/strong\u003e的配置基本就完成了。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eRunner还有更多的配置，详情可以参考官方文档介绍。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"创建普通用户帐号\"\u003e创建普通用户帐号\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#创建普通用户帐号\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e接着我们打开一个隐私页面，进入登录界面，这次我们点击\u003ccode\u003eRegister now\u003c/code\u003e来新建用户，填写完用户信息后，注册一个新的用户，然后需要管理员在用户管理界面上进行批准，批准通过后，刚注册的用户就可以正常登录系统了，如下图（图中的用户已经新建了一个仓库）：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/279ae5d2774b.png\" alt=\"user-projects\"\u003e\u003c/p\u003e\n\u003cp\u003e该普通用户帐户是开发者，后面测试CI/CD系统将以该用户进行测试。\u003c/p\u003e\n\u003ch4 id=\"创建仓库\"\u003e创建仓库\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#创建仓库\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e新建仓库非常简单，只需点击\u003ccode\u003eNew project\u003c/code\u003e后，填写项目基本信息即可：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/e89af7df63df.png\" alt=\"new-project\"\u003e\u003c/p\u003e\n\u003ch4 id=\"设置仓库的-gitlab-ci\"\u003e设置仓库的 gitlab-ci\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#设置仓库的-gitlab-ci\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e设置仓库根目录下的\u003ccode\u003e.gitlab-ci.yml\u003c/code\u003e文件，添加流水线任务。\u003c/p\u003e\n\u003cp\u003e我写的非常简单，\u003ccode\u003escript\u003c/code\u003e指定编译命令，\u003ccode\u003eonly\u003c/code\u003e指定在哪一个分支下进行CI部署（我指定的是：main分支），然后\u003ccode\u003etags\u003c/code\u003e和注册\u003cstrong\u003eRunner\u003c/strong\u003e的\u003ccode\u003etags\u003c/code\u003e一一对应的。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e关于\u003ccode\u003egitlab-ci.yml\u003c/code\u003e文件的更多细节可以参考\u003ca href=\"https://docs.gitlab.com/ee/ci/yaml/gitlab_ci_yaml.html\"\u003e官方文档\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4 id=\"提交代码并进行-ci-操作\"\u003e提交代码并进行 CI 操作\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#提交代码并进行-ci-操作\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e当一切都准备妥当后，下面就是写代码，并提交到远程仓库的main分支下：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/fc979b40e6df.png\" alt=\"git-push\"\u003e\u003c/p\u003e\n\u003cp\u003e刚提交了代码，系统上立即显示流水线就已经在更新了。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/94be700a77c7.png\" alt=\"pipelines\"\u003e\u003c/p\u003e\n\u003cp\u003e可以点开正在执行的流水，查看任务细节：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/deploygitlabcerunner/121b5fa098bf.png\" alt=\"pipeline-success\"\u003e\u003c/p\u003e\n\u003cp\u003e至此，这个\u003cstrong\u003eGitLab\u003c/strong\u003e的基本配置，和它的CI/CD流水配置，以及使用也已经完成，这套代码管理系统的实用性，总体来说还算不错的。\u003c/p\u003e\n\u003ch2 id=\"具体配置\"\u003e具体配置\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#具体配置\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e以下两个文件是我的测试配置，仅供参考。\u003c/p\u003e\n\u003ch3 id=\"我的测试配置\"\u003e我的测试配置\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#我的测试配置\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003e.gitlab-ci.yml\u003c/code\u003e配置如下：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003eyaml\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003estages:\u003c/span\u003e\n  \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebuild\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003ebuild source:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003estage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebuild\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003etags:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003elinux\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003escript:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egcc\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e-o\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emain\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emain.c\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eonly:\u003c/span\u003e\n    \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003emain\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003einterruptible:\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003edocker-compose.yml\u003c/code\u003e配置如下：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003eyaml\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003eversion:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"3.0\"\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003eservices:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003egitlab-web:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egitlab/gitlab-ce\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003erestart:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ealways\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ehostname:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'gitlab.me'\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eenvironment:\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eGITLAB_OMNIBUS_CONFIG:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e|\n        external_url 'http://gitlab.me:2080/'\n\u003c/span\u003e    \u003cspan class=\"hljs-attr\"\u003eports:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'2080:2080'\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'2443:443'\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./gitlab/config:/etc/gitlab\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./gitlab/logs:/var/log/gitlab\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./gitlab/data:/var/opt/gitlab\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003enetworks:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egitlab\u003c/span\u003e\n\n  \u003cspan class=\"hljs-attr\"\u003egitlab-runner:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eimage:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egitlab/gitlab-runner:alpine\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003erestart:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ealways\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003edepends_on:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egitlab-web\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003evolumes:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e/var/run/docker.sock:/var/run/docker.sock\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e./gitlab/gitlab-runner:/etc/gitlab-runner\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003enetworks:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egitlab\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003enetworks:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003egitlab:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003egitlab-network\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"我遇到的坑\"\u003e我遇到的坑\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#我遇到的坑\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e可能会碰到的坑：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003edocker-compose.yml\u003c/code\u003e文件中设置环境变量\u003ccode\u003eGITLAB_OMNIBUS_CONFIG\u003c/code\u003e中的\u003ccode\u003eexternal_url\u003c/code\u003e，如果域名带端口，docker的服务监听会绑定到该端口上；\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003egitlab-runner\u003c/code\u003e的配置（config.toml），\u003ccode\u003erunner.docker\u003c/code\u003e节区下添加\u003ccode\u003enetwork_mode\u003c/code\u003e为\u003ccode\u003egitlab-network\u003c/code\u003e以对应\u003ccode\u003edocker-compose.yml\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"链接\"\u003e链接\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#链接\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://www.czerniga.it/2021/11/14/how-to-install-gitlab-using-docker-compose/\"\u003ehow-to-install-gitlab-using-docker-compose\u003c/a\u003e\u003c/p\u003e"])</script><script>self.__next_f.push([1,"7:[\"$\",\"$L15\",null,{\"postData\":{\"id\":\"deploygitlabcerunner\",\"contentHtml\":\"$16\",\"title\":\"玩转自搭建 GitLab 社区版\",\"date\":\"$D2022-07-02T10:03:12.000Z\",\"updated\":\"$D2022-07-02T10:03:12.000Z\",\"categories\":[\"随笔\"],\"tags\":[\"git\",\"linux\"]}}]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"14:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"玩转自搭建 GitLab 社区版\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"HCHEN90 博客\"}],[\"$\",\"link\",\"2\",{\"rel\":\"alternate\",\"type\":\"application/atom+xml\",\"href\":\"https://hchen90.top/atom.xml\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]],\"error\":null,\"digest\":\"$undefined\"}\ne:{\"metadata\":\"$14:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>