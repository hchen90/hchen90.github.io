<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/283bb1ed86b49fd2.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/09ec4099fb721b31.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/09dfadb69bdaa005.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/54b9acc791aa599c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-ede82f7d0ae11dac.js"/><script src="/_next/static/chunks/4bd1b696-299743f5624cdabe.js" async=""></script><script src="/_next/static/chunks/684-481501000630d05e.js" async=""></script><script src="/_next/static/chunks/main-app-eb9456c5a3bb7ef4.js" async=""></script><script src="/_next/static/chunks/766-f505dbd3efffaa4c.js" async=""></script><script src="/_next/static/chunks/226-13d4d3f1fc18ceb6.js" async=""></script><script src="/_next/static/chunks/app/layout-bc83bfd6141341e7.js" async=""></script><script src="/_next/static/chunks/874-e909718850e7282e.js" async=""></script><script src="/_next/static/chunks/734-02ba314a893e68e9.js" async=""></script><script src="/_next/static/chunks/351-7dd07b3f065cc09a.js" async=""></script><script src="/_next/static/chunks/app/post/%5Bid%5D/page-871a46f82159f9c4.js" async=""></script><title>软件设计模式 - 结构型模式</title><meta name="description" content="HCHEN90 博客"/><link rel="alternate" type="application/atom+xml" href="https://hchen90.top/atom.xml"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="antialiased relative"><div class="fixed top-4 right-4 z-50"><a href="https://github.com/hchen90" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow duration-300" title="Visit my GitHub profile"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></div><div class="min-h-screen relative"><div class="fixed top-0 left-0 h-1 bg-blue-500 z-50 transition-all duration-300" style="width:0%"></div><button class="fixed bottom-24 right-8 p-3 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg transition-opacity duration-300 z-50 opacity-0 pointer-events-none" aria-label="Back to top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"></path></svg></button><div class="main-content transition-all duration-300"><div class="max-w-4xl mx-auto px-4 py-8"><div class="mb-8"><a class="text-blue-500 hover:underline mb-4 inline-block" href="/">← 返回首页</a></div><article><header class="mb-8"><h1 class="text-4xl font-bold mb-4">软件设计模式 - 结构型模式</h1><div class="text-gray-500 mb-4">2017年6月6日</div></header><div class="markdown-content"><h1 id="软件设计模式---结构型模式">软件设计模式 - 结构型模式<a aria-hidden="true" tabindex="-1" href="#软件设计模式---结构型模式"><span class="anchor-link"> #</span></a></h1>
<p>结构型模式介绍类和对象的组装方式，同时保持较大的灵活性和高效性。</p>
<p>结构型模式包括：适配器，桥接，组合，装饰，外观，享元，代理。</p>
<h2 id="适配器模式adapter">适配器模式（Adapter）<a aria-hidden="true" tabindex="-1" href="#适配器模式adapter"><span class="anchor-link"> #</span></a></h2>
<p>适配器模式是为了解决不同接口之间的适配问题。</p>
<p>适配器通常分为两类：对象适配器，类适配器。</p>
<h3 id="对象适配器">对象适配器<a aria-hidden="true" tabindex="-1" href="#对象适配器"><span class="anchor-link"> #</span></a></h3>
<p>对象适配器是通过实现接口来做到适配的，如下：</p>
<p><img src="/post/softwaredesignpattern3/5f2239c668b3.png" alt="Object Adapter"></p>
<p>示例代码：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawService</span> {
    <span class="hljs-comment">// 绘图服务</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">paint</span><span class="hljs-params">(Graphics&#x26;)</span> </span>{
        <span class="hljs-comment">// 使用Graphics绘图</span>
    }
    <span class="hljs-function">Graphics&#x26; <span class="hljs-title">getCanvasGraphics</span><span class="hljs-params">(canvas&#x26;)</span> </span>{
        <span class="hljs-comment">// 图形绘板转换</span>
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawInterface</span> {
    <span class="hljs-comment">// 绘图适配器接口</span>
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(canvas&#x26;)</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawAdapter</span> : <span class="hljs-keyword">public</span> DrawInterface {
    <span class="hljs-comment">// 绘图适配器</span>
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(canvas&#x26; c)</span> </span>{ <span class="hljs-comment">// 接口适配</span>
        <span class="hljs-keyword">auto</span> g = service.<span class="hljs-built_in">getCanvasGraphics</span>(c);
        service.<span class="hljs-built_in">paint</span>(g);
    }
<span class="hljs-keyword">private</span>:
    DrawService service;
};
</code></pre></div>
<h3 id="类适配器">类适配器<a aria-hidden="true" tabindex="-1" href="#类适配器"><span class="anchor-link"> #</span></a></h3>
<p>类适配器是通过面相对象编程的继承达到的，用于多继承方式实现。</p>
<p>如图所示：</p>
<p><img src="/post/softwaredesignpattern3/7b312890a4c8.png" alt="Class Adapter"></p>
<p>实例代码：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawGraphics</span> {
    <span class="hljs-comment">// 图案绘制</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(Graphics&#x26;)</span> </span>{
        <span class="hljs-comment">// 绘制函数</span>
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawService</span> {
    <span class="hljs-comment">// 绘制服务</span>
<span class="hljs-keyword">protected</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">paint</span><span class="hljs-params">(Graphics&#x26;)</span> </span>{
        <span class="hljs-comment">// 绘制</span>
    }
    <span class="hljs-function">Graphics&#x26; <span class="hljs-title">getCanvasGraphics</span><span class="hljs-params">(canvas&#x26;)</span> </span>{
        <span class="hljs-comment">// 转换画板</span>
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawAdapter</span> : <span class="hljs-keyword">public</span> DrawGraphics, <span class="hljs-keyword">public</span> DrawService {
    <span class="hljs-comment">// 绘制适配器</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(canvas&#x26; c)</span> </span>{
        <span class="hljs-keyword">auto</span> g = <span class="hljs-built_in">getCanvasGraphics</span>(c);
        <span class="hljs-built_in">paint</span>(g);
    }
};
</code></pre></div>
<h2 id="桥接模式bridge">桥接模式（Bridge）<a aria-hidden="true" tabindex="-1" href="#桥接模式bridge"><span class="anchor-link"> #</span></a></h2>
<p>桥接模式是将抽象和实现分为两个独立的层次，将原本不同维度的继承方式改成组合方式。</p>
<p>如下图所示：</p>
<p><img src="/post/softwaredesignpattern3/d48eba393b9c.png" alt="Bridge"></p>
<p>示例代码：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-comment">// 画笔风格</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Style</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(Canvas&#x26;)</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Pencil</span> : <span class="hljs-keyword">public</span> Style {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(Canvas&#x26;)</span> </span>{
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 铅笔绘制实现</span>
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Brush</span> : <span class="hljs-keyword">public</span> Style {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(Canvas&#x26;)</span> </span>{
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 画刷绘制实现</span>
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Pastel</span> : <span class="hljs-keyword">public</span> Style {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(Canvas&#x26;)</span> </span>{
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 蜡笔绘制实现</span>
    }
};

<span class="hljs-comment">// 形状</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Square</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">drawWithPen</span><span class="hljs-params">(Style&#x26; pen)</span> </span>{
        pen.<span class="hljs-built_in">draw</span>(<span class="hljs-keyword">this</span>-><span class="hljs-built_in">getCanvas</span>());
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">drawWithPen</span><span class="hljs-params">(Style&#x26; pen)</span> </span>{
        pen.<span class="hljs-built_in">draw</span>(<span class="hljs-keyword">this</span>-><span class="hljs-built_in">getCanvas</span>());
    }
};
</code></pre></div>
<p>形状类只是抽象绘制层，可以绘制不同风格的图形，但是对于具体的绘制实现其实由不同风格的画笔来实现。</p>
<h2 id="组合模式composite">组合模式（Composite）<a aria-hidden="true" tabindex="-1" href="#组合模式composite"><span class="anchor-link"> #</span></a></h2>
<p>组合模式用于将对象组合成树状结构，通常这种模式的实现方式多见为“盒子”（Box）与“产品”（Item）的交互方式，盒子本身也是产品，盒子可以存放产品，从而产生递归嵌套的结构。</p>
<p>结构如下：</p>
<p><img src="/post/softwaredesignpattern3/4c391f951bae.png" alt="Composite"></p>
<p>示例代码：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
<span class="hljs-keyword">protected</span>:
    <span class="hljs-type">float</span> x, y;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> : <span class="hljs-keyword">public</span> Shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 绘制圆形</span>
    }
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">float</span> radius;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Square</span> : <span class="hljs-keyword">public</span> Shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 绘制方块</span>
    }
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">float</span> width, height;
};

<span class="hljs-comment">// 组合图形</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CompoundShape</span> : <span class="hljs-keyword">public</span> Shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 迭代绘制所有子图形</span>
    }
<span class="hljs-keyword">private</span>:
    std::vector&#x3C;Shape> childs;
};
</code></pre></div>
<h2 id="装饰模式decorator">装饰模式（Decorator）<a aria-hidden="true" tabindex="-1" href="#装饰模式decorator"><span class="anchor-link"> #</span></a></h2>
<p>装饰器模式允许将对象放入包含某种行为的特殊对象，从而为原来的对象绑定特殊对象的新行为。</p>
<p>结构如下：</p>
<p><img src="/post/softwaredesignpattern3/c0920326f4f1.png" alt="Decorator"></p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> : <span class="hljs-keyword">public</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 绘制</span>
    }
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">float</span> radius;
};

<span class="hljs-comment">// 装饰器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BrushDecorator</span> : <span class="hljs-keyword">public</span> Shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">BrushDecorator</span>(Shape&#x26; s) {
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 设置画刷风格</span>
    }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 绘制</span>
        Shape::<span class="hljs-built_in">draw</span>();
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PastelDecorator</span> : <span class="hljs-keyword">public</span> Shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">PastelDecorator</span>(Shape&#x26; s) {
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 设置蜡笔风格</span>
    }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 绘制</span>
        Shape::<span class="hljs-built_in">draw</span>();
    }
};
</code></pre></div>
<p>使用装饰器模式，如下：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp">Circle circle;

<span class="hljs-keyword">auto</span> circleWithBrush = <span class="hljs-keyword">new</span> <span class="hljs-built_in">BrushDecorator</span>(circle);
<span class="hljs-keyword">auto</span> circleWithPastel = <span class="hljs-keyword">new</span> <span class="hljs-built_in">PastelDecorator</span>(circle);
<span class="hljs-keyword">auto</span> circleWithBrushPastel = <span class="hljs-keyword">new</span> <span class="hljs-built_in">PastelDecorator</span>(circleWithBrush); <span class="hljs-comment">// 嵌套装饰</span>

circleWithBrush.<span class="hljs-built_in">draw</span>();
circleWithPastel.<span class="hljs-built_in">draw</span>();
circleWithBrushPastel.<span class="hljs-built_in">draw</span>();
</code></pre></div>
<h2 id="外观模式facade">外观模式（Facade）<a aria-hidden="true" tabindex="-1" href="#外观模式facade"><span class="anchor-link"> #</span></a></h2>
<p>外观模式是为了给库/框架设计一套简单的接口，这样对外减少细节暴露，从而减少系统的耦合度。</p>
<p>如下示例，设计了一种统一风格的徽章绘制模式：</p>
<p><img src="/post/softwaredesignpattern3/eb503e9c579c.png" alt="Facade"></p>
<p>示例代码：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(Canvas&#x26;)</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CompoundShape</span> : <span class="hljs-keyword">public</span> Shape {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addChild</span><span class="hljs-params">(Shape&#x26; c)</span> </span>{
        <span class="hljs-comment">// 添加图形</span>
    }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(Canvas&#x26;)</span> </span>{
        <span class="hljs-comment">// 绘制图形</span>
    }
<span class="hljs-keyword">private</span>:
    std::vector&#x3C;Shape> childs;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Brush</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setPen</span><span class="hljs-params">(Canvas&#x26;)</span></span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Background</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fill</span><span class="hljs-params">(Canvas&#x26;)</span></span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Badget</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">drawBadget</span><span class="hljs-params">(Shape&#x26; s)</span> </span>{
        <span class="hljs-comment">// 绘制徽章</span>
        <span class="hljs-keyword">auto</span> canvas = <span class="hljs-keyword">this</span>-><span class="hljs-built_in">getCanvas</span>();
        <span class="hljs-built_in">assert</span>(canvas != <span class="hljs-literal">nullptr</span>);
        br.<span class="hljs-built_in">setPen</span>(*canvas);
        bg.<span class="hljs-built_in">fill</span>(*canvas);
        s.<span class="hljs-built_in">draw</span>(*canvas);
    }
<span class="hljs-keyword">private</span>:
    Brush br;
    Background bg;
    CompundShape cshape;
};
</code></pre></div>
<p>对于外部调用者来说，只需调用<code>drawBadget()</code>，将徽章复杂图形变量作为形式参数传入函数，即可完成各种徽章的绘制。</p>
<h2 id="享元模式flyweight">享元模式（Flyweight）<a aria-hidden="true" tabindex="-1" href="#享元模式flyweight"><span class="anchor-link"> #</span></a></h2>
<p>享元模式是通过共享对象状态，使得对象不必保存所有的状态，从而达到在内存中载入更多的对象。</p>
<p>常见应用场景是游戏制作场景，游戏中最常见的元素是粒子系统，每一个粒子都有自己的坐标，颜色，状态等信息，如果每一个粒子对象都存储所有的信息，那么在实际游戏场景中将会对内存需求巨大，几十万个粒子就会导致系统内存被用完，从而导致OOM，为了解决这个问题，可以从对象的类来分析，提取其中的常量和变量，对于常量使用共享对象存储。</p>
<p>如下：</p>
<p><img src="/post/softwaredesignpattern3/977e46e42cd8.png" alt="Flyweight"></p>
<p>示例代码：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Background</span> {};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Color</span> {};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Flyweight</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 绘制粒子</span>
    }
<span class="hljs-keyword">private</span>:
    Background bg;
    Color cr;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FlyweightFactory</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">Flyweight* <span class="hljs-title">getFlyweight</span><span class="hljs-params">(state s)</span> </span>{
        <span class="hljs-keyword">auto</span> f = cache.<span class="hljs-built_in">find</span>(s);
        <span class="hljs-keyword">if</span> (f != <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span> f;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Flyweight</span>();
    }
<span class="hljs-keyword">private</span>:
    Cache cache;
};
</code></pre></div>
<p>享元模式使用前还需要进行初始化，以便将常量对象存储到享元工厂的cache中。</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-comment">// 初始化享元工厂</span>
<span class="hljs-keyword">auto</span> particle1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Flyweight</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 静态粒子1</span>
<span class="hljs-keyword">auto</span> particle2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Flyweight</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// 静态粒子2</span>
<span class="hljs-comment">// ...</span>

FlyweightFactory::<span class="hljs-built_in">getInstance</span>().<span class="hljs-built_in">addFlyweight</span>(particle1);
FlyweightFactory::<span class="hljs-built_in">getInstance</span>().<span class="hljs-built_in">addFlyweight</span>(particle2);

<span class="hljs-keyword">auto</span> particle = FlyweightFactory::<span class="hljs-built_in">getInstance</span>().<span class="hljs-built_in">getFlyweight</span>(<span class="hljs-number">-1</span>); <span class="hljs-comment">// 普通动态粒子</span>
</code></pre></div>
<h2 id="代理模式proxy">代理模式（Proxy）<a aria-hidden="true" tabindex="-1" href="#代理模式proxy"><span class="anchor-link"> #</span></a></h2>
<p>代理模式提供对对象访问的占位，控制对原始对象的访问，可以做到在外界对对象请求操作前后添加额外处理。</p>
<p>还是以绘图案例为例，这里绘制的是图片，这些图片以tag为唯一名称存储在数据库中，每次绘制需要从数据库获取相应的图片，再进行绘制，但是，如果绘制的图形复杂，包含的图片较多的时候，绘制效率会很低，绘制界面就会出现绘制延迟的现象，根本原因是从数据库获取图片的累加时间太长了。所以解决这种问题，就要用到代理器的模式，如下：</p>
<p><img src="/post/softwaredesignpattern3/68bf559f3059.png" alt="Proxy"></p>
<p>这里的代理器在获取到图片的时候，会对已经获取的图片做缓存，这样下次再次获取该图片，就可以立即返回该图片，从而大大减少绘制时间，使绘制效率变高。</p>
<p>案例代码：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Image</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">std::vector&#x3C;std::string> <span class="hljs-title">listImages</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function">std::vector&#x3C;<span class="hljs-type">uint8_t</span>> <span class="hljs-title">getImage</span><span class="hljs-params">(std::string&#x26;)</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DBImage</span> : <span class="hljs-keyword">public</span> Image {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">std::vector&#x3C;std::string> <span class="hljs-title">listImages</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">auto</span> result = db.<span class="hljs-built_in">findAll</span>();
        <span class="hljs-comment">// 数据库查询返回所有的图片的tag列表</span>
    };
    <span class="hljs-function">std::vector&#x3C;<span class="hljs-type">uint8_t</span>> <span class="hljs-title">getImage</span><span class="hljs-params">(std::string&#x26;)</span> </span>{
        <span class="hljs-comment">// 返回对应tag的图片数据</span>
    };
<span class="hljs-keyword">private</span>:
    DB db;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CachedImage</span> : <span class="hljs-keyword">public</span> Image {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">CachedImage</span>(DBImage&#x26; dbi) {}
    <span class="hljs-function">std::vector&#x3C;std::string> <span class="hljs-title">listImages</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">auto</span> result = cache.<span class="hljs-built_in">findAll</span>(); <span class="hljs-comment">// 缓存查找</span>
        <span class="hljs-keyword">if</span> (!result.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">return</span> result;
        }
        result = service.<span class="hljs-built_in">findAll</span>(); <span class="hljs-comment">// 原始服务查找</span>
        cache.<span class="hljs-built_in">store</span>(result);
        <span class="hljs-keyword">return</span> result;
    };
    <span class="hljs-function">std::vector&#x3C;<span class="hljs-type">uint8_t</span>> <span class="hljs-title">getImage</span><span class="hljs-params">(std::string&#x26; tag)</span> </span>{
        <span class="hljs-keyword">auto</span> img = cache.<span class="hljs-built_in">find</span>(tag); <span class="hljs-comment">// 缓存查找图片</span>
        <span class="hljs-keyword">if</span> (!img.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">return</span> img;
        }
        img = service.<span class="hljs-built_in">find</span>(tag); <span class="hljs-comment">// 原始服务获取图片</span>
        cache.<span class="hljs-built_in">store</span>(tag, img);
        <span class="hljs-keyword">return</span> img;
    };
<span class="hljs-keyword">private</span>:
    DBImage service;
    Cache cache;
};
</code></pre></div>
<p>实际使用时，直接调用代理器即可：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-function">DBImage <span class="hljs-title">dbi</span><span class="hljs-params">(<span class="hljs-string">"mongo://xxxx"</span>)</span></span>;
<span class="hljs-function">CachedImage <span class="hljs-title">ci</span><span class="hljs-params">(dbi)</span></span>;

<span class="hljs-keyword">auto</span> result = ci.<span class="hljs-built_in">listImages</span>();
<span class="hljs-keyword">auto</span> image = ci.<span class="hljs-built_in">getImage</span>(result[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 第一个tag的图片</span>
</code></pre></div>
<blockquote>
<p>CacheImage</p>
<blockquote>
<p>CacheImage中使用的Cache，根据实际应用场景，可以是中间件存储，例如：Memcached，redis等。</p>
</blockquote>
</blockquote>
<h2 id="mvc模式mvc">MVC模式（MVC）<a aria-hidden="true" tabindex="-1" href="#mvc模式mvc"><span class="anchor-link"> #</span></a></h2>
<p>MVC分别代表：Model-View-Controller，这种方式应用于程序的分层开发，减少数据，视图界面，和逻辑控制之间的耦合，使开发维护更加清晰。</p>
<p>这种模式在传统的MFC开发框架中广泛使用。下面演示一个富文本编辑器的MVC设计。</p>
<p><img src="/post/softwaredesignpattern3/816f2afd2731.png" alt="MVC"></p>
<p>代码如下：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span> {};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">View</span> {};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Controller</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setView</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setModel</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Document</span> : <span class="hljs-keyword">public</span> Model {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Document</span>(Controller* ctrl) {
        <span class="hljs-keyword">this</span>->ctrl = ctrl;
    }
<span class="hljs-keyword">private</span>:
    Controller* ctrl;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RichEditCtrl</span> : <span class="hljs-keyword">public</span> Controller {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setView</span><span class="hljs-params">(View* v)</span> </span>{
        <span class="hljs-keyword">this</span>->view = v;
    }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setModel</span><span class="hljs-params">(Model* m)</span> </span>{
        <span class="hljs-keyword">this</span>->model = m;
    }
<span class="hljs-keyword">private</span>:
    View* view;
    Model* model;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RichEditView</span> : <span class="hljs-keyword">public</span> View {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">View</span>(Controller* ctrl) {
        <span class="hljs-keyword">this</span>->ctrl = ctrl;
    }
<span class="hljs-keyword">private</span>:
    Controller* ctrl;
};
</code></pre></div>
<p>构造MVC时如下：</p>
<div class="code-block-wrapper"><div class="code-block-header"><span class="code-block-lang">cpp</span><button class="copy-button" data-copy-state="copy" aria-label="Copy code to clipboard" type="button" onclick="copyCode(this)"><span class="copy-button-text">Copy</span></button></div><pre><code class="hljs language-cpp">RichEditCtrl ctrl;
<span class="hljs-function">RichEditView <span class="hljs-title">view</span><span class="hljs-params">(&#x26;ctrl)</span></span>;
<span class="hljs-function">Document <span class="hljs-title">doc</span><span class="hljs-params">(&#x26;ctrl)</span></span>;
ctrl.<span class="hljs-built_in">setView</span>(&#x26;view);
ctrl.<span class="hljs-built_in">setModel</span>(&#x26;doc);

<span class="hljs-comment">// 视图的更新通知控制器</span>
ctrl.<span class="hljs-built_in">notify</span>();
<span class="hljs-comment">// 控制器更新数据模型</span>
doc.<span class="hljs-built_in">update</span>();
<span class="hljs-comment">// 模型更新完后刷新视图</span>
view.<span class="hljs-built_in">refresh</span>();
</code></pre></div></div><div class="mt-12 pt-6 border-t border-gray-200 dark:border-gray-700"><a class="text-blue-500 hover:underline" href="/">← 返回所有文章列表</a></div><div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700 text-center text-gray-500 text-sm">© 2013 – 2025 陈祥</div></article></div></div></div><!--$--><!--/$--><!--$--><!--/$--><script src="/_next/static/chunks/webpack-ede82f7d0ae11dac.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7555,[],\"\"]\n3:I[1295,[],\"\"]\n4:I[415,[\"766\",\"static/chunks/766-f505dbd3efffaa4c.js\",\"226\",\"static/chunks/226-13d4d3f1fc18ceb6.js\",\"177\",\"static/chunks/app/layout-bc83bfd6141341e7.js\"],\"default\"]\n5:I[9243,[\"766\",\"static/chunks/766-f505dbd3efffaa4c.js\",\"226\",\"static/chunks/226-13d4d3f1fc18ceb6.js\",\"177\",\"static/chunks/app/layout-bc83bfd6141341e7.js\"],\"\"]\n8:I[9665,[],\"MetadataBoundary\"]\na:I[9665,[],\"OutletBoundary\"]\nd:I[4911,[],\"AsyncMetadataOutlet\"]\nf:I[9665,[],\"ViewportBoundary\"]\n11:I[6614,[],\"\"]\n:HL[\"/_next/static/css/283bb1ed86b49fd2.css\",\"style\"]\n:HL[\"/_next/static/css/09ec4099fb721b31.css\",\"style\"]\n:HL[\"/_next/static/css/09dfadb69bdaa005.css\",\"style\"]\n:HL[\"/_next/static/css/54b9acc791aa599c.css\",\"style\"]\n6:T4a2,\n          function copyCode(button) {\n            // Find the code element within the same wrapper\n            const codeWrapper = button.closest('.code-block-wrapper');\n            if (!codeWrapper) return;\n            \n            const codeElement = codeWrapper.querySelector('code');\n            if (!codeElement) return;\n            \n            // Get the text content\n            const text = codeElement.textContent;\n            \n            // Use the clipboard API to copy the text\n            navigator.clipboard.writeText(text).then(() =\u003e {\n              // Update the button state to show \"Copied!\"\n              button.setAttribute('data-copy-state', 'copied');\n              const buttonText = button.querySelector('.copy-button-text');\n              if (buttonText) buttonText.textContent = 'Copied!';\n              \n              // Reset after 2 seconds\n              setTimeout(() =\u003e {\n                button.setAttribute('data-copy-state', 'copy');\n                if (buttonText) buttonText.textContent = 'Copy';\n              }, 2000);\n            }).catch(err =\u003e {\n              console.error('Failed to copy text: ', err);\n            });\n          }\n          "])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"ZnA_pffjAXy0PvB3tEph0\",\"p\":\"\",\"c\":[\"\",\"post\",\"softwaredesignpattern3\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"post\",{\"children\":[[\"id\",\"softwaredesignpattern3\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/283bb1ed86b49fd2.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/09ec4099fb721b31.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"2\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/09dfadb69bdaa005.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"antialiased relative\",\"children\":[[\"$\",\"div\",null,{\"className\":\"fixed top-4 right-4 z-50\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/hchen90\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"flex items-center justify-center p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow duration-300\",\"title\":\"Visit my GitHub profile\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"24\",\"height\":\"24\",\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"children\":[\"$\",\"path\",null,{\"d\":\"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z\"}]}]}]}],[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"$L4\",null,{}],[\"$\",\"$L5\",null,{\"id\":\"code-copy\",\"children\":\"$6\"}]]}]}]]}],{\"children\":[\"post\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"softwaredesignpattern3\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/54b9acc791aa599c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"vIZofi63PVDeKNBjetffe\",{\"children\":[[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$11\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"12:\"$Sreact.suspense\"\n13:I[4911,[],\"AsyncMetadata\"]\n9:[\"$\",\"$12\",null,{\"fallback\":null,\"children\":[\"$\",\"$L13\",null,{\"promise\":\"$@14\"}]}]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script><script>self.__next_f.push([1,"15:I[9543,[\"874\",\"static/chunks/874-e909718850e7282e.js\",\"734\",\"static/chunks/734-02ba314a893e68e9.js\",\"351\",\"static/chunks/351-7dd07b3f065cc09a.js\",\"457\",\"static/chunks/app/post/%5Bid%5D/page-871a46f82159f9c4.js\"],\"default\"]\n16:T83ce,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"软件设计模式---结构型模式\"\u003e软件设计模式 - 结构型模式\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#软件设计模式---结构型模式\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e结构型模式介绍类和对象的组装方式，同时保持较大的灵活性和高效性。\u003c/p\u003e\n\u003cp\u003e结构型模式包括：适配器，桥接，组合，装饰，外观，享元，代理。\u003c/p\u003e\n\u003ch2 id=\"适配器模式adapter\"\u003e适配器模式（Adapter）\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#适配器模式adapter\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e适配器模式是为了解决不同接口之间的适配问题。\u003c/p\u003e\n\u003cp\u003e适配器通常分为两类：对象适配器，类适配器。\u003c/p\u003e\n\u003ch3 id=\"对象适配器\"\u003e对象适配器\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#对象适配器\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e对象适配器是通过实现接口来做到适配的，如下：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/softwaredesignpattern3/5f2239c668b3.png\" alt=\"Object Adapter\"\u003e\u003c/p\u003e\n\u003cp\u003e示例代码：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDrawService\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 绘图服务\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003epaint\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Graphics\u0026#x26;)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 使用Graphics绘图\u003c/span\u003e\n    }\n    \u003cspan class=\"hljs-function\"\u003eGraphics\u0026#x26; \u003cspan class=\"hljs-title\"\u003egetCanvasGraphics\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(canvas\u0026#x26;)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 图形绘板转换\u003c/span\u003e\n    }\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDrawInterface\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 绘图适配器接口\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(canvas\u0026#x26;)\u003c/span\u003e \u003c/span\u003e= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDrawAdapter\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e DrawInterface {\n    \u003cspan class=\"hljs-comment\"\u003e// 绘图适配器\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(canvas\u0026#x26; c)\u003c/span\u003e \u003c/span\u003e{ \u003cspan class=\"hljs-comment\"\u003e// 接口适配\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e g = service.\u003cspan class=\"hljs-built_in\"\u003egetCanvasGraphics\u003c/span\u003e(c);\n        service.\u003cspan class=\"hljs-built_in\"\u003epaint\u003c/span\u003e(g);\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    DrawService service;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"类适配器\"\u003e类适配器\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#类适配器\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e类适配器是通过面相对象编程的继承达到的，用于多继承方式实现。\u003c/p\u003e\n\u003cp\u003e如图所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/softwaredesignpattern3/7b312890a4c8.png\" alt=\"Class Adapter\"\u003e\u003c/p\u003e\n\u003cp\u003e实例代码：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDrawGraphics\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 图案绘制\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Graphics\u0026#x26;)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 绘制函数\u003c/span\u003e\n    }\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDrawService\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 绘制服务\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003epaint\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Graphics\u0026#x26;)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 绘制\u003c/span\u003e\n    }\n    \u003cspan class=\"hljs-function\"\u003eGraphics\u0026#x26; \u003cspan class=\"hljs-title\"\u003egetCanvasGraphics\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(canvas\u0026#x26;)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 转换画板\u003c/span\u003e\n    }\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDrawAdapter\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e DrawGraphics, \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e DrawService {\n    \u003cspan class=\"hljs-comment\"\u003e// 绘制适配器\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(canvas\u0026#x26; c)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e g = \u003cspan class=\"hljs-built_in\"\u003egetCanvasGraphics\u003c/span\u003e(c);\n        \u003cspan class=\"hljs-built_in\"\u003epaint\u003c/span\u003e(g);\n    }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"桥接模式bridge\"\u003e桥接模式（Bridge）\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#桥接模式bridge\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e桥接模式是将抽象和实现分为两个独立的层次，将原本不同维度的继承方式改成组合方式。\u003c/p\u003e\n\u003cp\u003e如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/softwaredesignpattern3/d48eba393b9c.png\" alt=\"Bridge\"\u003e\u003c/p\u003e\n\u003cp\u003e示例代码：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 画笔风格\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eStyle\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Canvas\u0026#x26;)\u003c/span\u003e \u003c/span\u003e= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePencil\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Style {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Canvas\u0026#x26;)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// \u003cspan class=\"hljs-doctag\"\u003eTODO:\u003c/span\u003e 铅笔绘制实现\u003c/span\u003e\n    }\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBrush\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Style {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Canvas\u0026#x26;)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// \u003cspan class=\"hljs-doctag\"\u003eTODO:\u003c/span\u003e 画刷绘制实现\u003c/span\u003e\n    }\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePastel\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Style {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Canvas\u0026#x26;)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// \u003cspan class=\"hljs-doctag\"\u003eTODO:\u003c/span\u003e 蜡笔绘制实现\u003c/span\u003e\n    }\n};\n\n\u003cspan class=\"hljs-comment\"\u003e// 形状\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSquare\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawWithPen\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Style\u0026#x26; pen)\u003c/span\u003e \u003c/span\u003e{\n        pen.\u003cspan class=\"hljs-built_in\"\u003edraw\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e-\u003e\u003cspan class=\"hljs-built_in\"\u003egetCanvas\u003c/span\u003e());\n    }\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCircle\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawWithPen\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Style\u0026#x26; pen)\u003c/span\u003e \u003c/span\u003e{\n        pen.\u003cspan class=\"hljs-built_in\"\u003edraw\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e-\u003e\u003cspan class=\"hljs-built_in\"\u003egetCanvas\u003c/span\u003e());\n    }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e形状类只是抽象绘制层，可以绘制不同风格的图形，但是对于具体的绘制实现其实由不同风格的画笔来实现。\u003c/p\u003e\n\u003ch2 id=\"组合模式composite\"\u003e组合模式（Composite）\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#组合模式composite\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e组合模式用于将对象组合成树状结构，通常这种模式的实现方式多见为“盒子”（Box）与“产品”（Item）的交互方式，盒子本身也是产品，盒子可以存放产品，从而产生递归嵌套的结构。\u003c/p\u003e\n\u003cp\u003e结构如下：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/softwaredesignpattern3/4c391f951bae.png\" alt=\"Composite\"\u003e\u003c/p\u003e\n\u003cp\u003e示例代码：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eShape\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e:\n    \u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e x, y;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCircle\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Shape {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 绘制圆形\u003c/span\u003e\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    \u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e radius;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eSquare\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Shape {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 绘制方块\u003c/span\u003e\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    \u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e width, height;\n};\n\n\u003cspan class=\"hljs-comment\"\u003e// 组合图形\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCompoundShape\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Shape {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 迭代绘制所有子图形\u003c/span\u003e\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    std::vector\u0026#x3C;Shape\u003e childs;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"装饰模式decorator\"\u003e装饰模式（Decorator）\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#装饰模式decorator\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e装饰器模式允许将对象放入包含某种行为的特殊对象，从而为原来的对象绑定特殊对象的新行为。\u003c/p\u003e\n\u003cp\u003e结构如下：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/softwaredesignpattern3/c0920326f4f1.png\" alt=\"Decorator\"\u003e\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eShape\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003evirtual\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCircle\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// \u003cspan class=\"hljs-doctag\"\u003eTODO:\u003c/span\u003e 绘制\u003c/span\u003e\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    \u003cspan class=\"hljs-type\"\u003efloat\u003c/span\u003e radius;\n};\n\n\u003cspan class=\"hljs-comment\"\u003e// 装饰器\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBrushDecorator\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Shape {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-built_in\"\u003eBrushDecorator\u003c/span\u003e(Shape\u0026#x26; s) {\n        \u003cspan class=\"hljs-comment\"\u003e// \u003cspan class=\"hljs-doctag\"\u003eTODO:\u003c/span\u003e 设置画刷风格\u003c/span\u003e\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 绘制\u003c/span\u003e\n        Shape::\u003cspan class=\"hljs-built_in\"\u003edraw\u003c/span\u003e();\n    }\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePastelDecorator\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Shape {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-built_in\"\u003ePastelDecorator\u003c/span\u003e(Shape\u0026#x26; s) {\n        \u003cspan class=\"hljs-comment\"\u003e// \u003cspan class=\"hljs-doctag\"\u003eTODO:\u003c/span\u003e 设置蜡笔风格\u003c/span\u003e\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 绘制\u003c/span\u003e\n        Shape::\u003cspan class=\"hljs-built_in\"\u003edraw\u003c/span\u003e();\n    }\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e使用装饰器模式，如下：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003eCircle circle;\n\n\u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e circleWithBrush = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eBrushDecorator\u003c/span\u003e(circle);\n\u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e circleWithPastel = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePastelDecorator\u003c/span\u003e(circle);\n\u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e circleWithBrushPastel = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePastelDecorator\u003c/span\u003e(circleWithBrush); \u003cspan class=\"hljs-comment\"\u003e// 嵌套装饰\u003c/span\u003e\n\ncircleWithBrush.\u003cspan class=\"hljs-built_in\"\u003edraw\u003c/span\u003e();\ncircleWithPastel.\u003cspan class=\"hljs-built_in\"\u003edraw\u003c/span\u003e();\ncircleWithBrushPastel.\u003cspan class=\"hljs-built_in\"\u003edraw\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"外观模式facade\"\u003e外观模式（Facade）\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#外观模式facade\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e外观模式是为了给库/框架设计一套简单的接口，这样对外减少细节暴露，从而减少系统的耦合度。\u003c/p\u003e\n\u003cp\u003e如下示例，设计了一种统一风格的徽章绘制模式：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/softwaredesignpattern3/eb503e9c579c.png\" alt=\"Facade\"\u003e\u003c/p\u003e\n\u003cp\u003e示例代码：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eShape\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Canvas\u0026#x26;)\u003c/span\u003e \u003c/span\u003e= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCompoundShape\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Shape {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eaddChild\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Shape\u0026#x26; c)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 添加图形\u003c/span\u003e\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Canvas\u0026#x26;)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 绘制图形\u003c/span\u003e\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    std::vector\u0026#x3C;Shape\u003e childs;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBrush\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esetPen\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Canvas\u0026#x26;)\u003c/span\u003e\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBackground\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efill\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Canvas\u0026#x26;)\u003c/span\u003e\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBadget\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawBadget\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Shape\u0026#x26; s)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 绘制徽章\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e canvas = \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e-\u003e\u003cspan class=\"hljs-built_in\"\u003egetCanvas\u003c/span\u003e();\n        \u003cspan class=\"hljs-built_in\"\u003eassert\u003c/span\u003e(canvas != \u003cspan class=\"hljs-literal\"\u003enullptr\u003c/span\u003e);\n        br.\u003cspan class=\"hljs-built_in\"\u003esetPen\u003c/span\u003e(*canvas);\n        bg.\u003cspan class=\"hljs-built_in\"\u003efill\u003c/span\u003e(*canvas);\n        s.\u003cspan class=\"hljs-built_in\"\u003edraw\u003c/span\u003e(*canvas);\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    Brush br;\n    Background bg;\n    CompundShape cshape;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e对于外部调用者来说，只需调用\u003ccode\u003edrawBadget()\u003c/code\u003e，将徽章复杂图形变量作为形式参数传入函数，即可完成各种徽章的绘制。\u003c/p\u003e\n\u003ch2 id=\"享元模式flyweight\"\u003e享元模式（Flyweight）\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#享元模式flyweight\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e享元模式是通过共享对象状态，使得对象不必保存所有的状态，从而达到在内存中载入更多的对象。\u003c/p\u003e\n\u003cp\u003e常见应用场景是游戏制作场景，游戏中最常见的元素是粒子系统，每一个粒子都有自己的坐标，颜色，状态等信息，如果每一个粒子对象都存储所有的信息，那么在实际游戏场景中将会对内存需求巨大，几十万个粒子就会导致系统内存被用完，从而导致OOM，为了解决这个问题，可以从对象的类来分析，提取其中的常量和变量，对于常量使用共享对象存储。\u003c/p\u003e\n\u003cp\u003e如下：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/softwaredesignpattern3/977e46e42cd8.png\" alt=\"Flyweight\"\u003e\u003c/p\u003e\n\u003cp\u003e示例代码：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eBackground\u003c/span\u003e {};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eColor\u003c/span\u003e {};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eFlyweight\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edraw\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 绘制粒子\u003c/span\u003e\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    Background bg;\n    Color cr;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eFlyweightFactory\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003eFlyweight* \u003cspan class=\"hljs-title\"\u003egetFlyweight\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(state s)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e f = cache.\u003cspan class=\"hljs-built_in\"\u003efind\u003c/span\u003e(s);\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (f != \u003cspan class=\"hljs-literal\"\u003enullptr\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e f;\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eFlyweight\u003c/span\u003e();\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    Cache cache;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e享元模式使用前还需要进行初始化，以便将常量对象存储到享元工厂的cache中。\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 初始化享元工厂\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e particle1 = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eFlyweight\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// 静态粒子1\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e particle2 = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eFlyweight\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// 静态粒子2\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\nFlyweightFactory::\u003cspan class=\"hljs-built_in\"\u003egetInstance\u003c/span\u003e().\u003cspan class=\"hljs-built_in\"\u003eaddFlyweight\u003c/span\u003e(particle1);\nFlyweightFactory::\u003cspan class=\"hljs-built_in\"\u003egetInstance\u003c/span\u003e().\u003cspan class=\"hljs-built_in\"\u003eaddFlyweight\u003c/span\u003e(particle2);\n\n\u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e particle = FlyweightFactory::\u003cspan class=\"hljs-built_in\"\u003egetInstance\u003c/span\u003e().\u003cspan class=\"hljs-built_in\"\u003egetFlyweight\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// 普通动态粒子\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"代理模式proxy\"\u003e代理模式（Proxy）\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#代理模式proxy\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e代理模式提供对对象访问的占位，控制对原始对象的访问，可以做到在外界对对象请求操作前后添加额外处理。\u003c/p\u003e\n\u003cp\u003e还是以绘图案例为例，这里绘制的是图片，这些图片以tag为唯一名称存储在数据库中，每次绘制需要从数据库获取相应的图片，再进行绘制，但是，如果绘制的图形复杂，包含的图片较多的时候，绘制效率会很低，绘制界面就会出现绘制延迟的现象，根本原因是从数据库获取图片的累加时间太长了。所以解决这种问题，就要用到代理器的模式，如下：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/softwaredesignpattern3/68bf559f3059.png\" alt=\"Proxy\"\u003e\u003c/p\u003e\n\u003cp\u003e这里的代理器在获取到图片的时候，会对已经获取的图片做缓存，这样下次再次获取该图片，就可以立即返回该图片，从而大大减少绘制时间，使绘制效率变高。\u003c/p\u003e\n\u003cp\u003e案例代码：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eImage\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003estd::vector\u0026#x3C;std::string\u003e \u003cspan class=\"hljs-title\"\u003elistImages\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-function\"\u003estd::vector\u0026#x3C;\u003cspan class=\"hljs-type\"\u003euint8_t\u003c/span\u003e\u003e \u003cspan class=\"hljs-title\"\u003egetImage\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(std::string\u0026#x26;)\u003c/span\u003e \u003c/span\u003e= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDBImage\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Image {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003estd::vector\u0026#x3C;std::string\u003e \u003cspan class=\"hljs-title\"\u003elistImages\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e result = db.\u003cspan class=\"hljs-built_in\"\u003efindAll\u003c/span\u003e();\n        \u003cspan class=\"hljs-comment\"\u003e// 数据库查询返回所有的图片的tag列表\u003c/span\u003e\n    };\n    \u003cspan class=\"hljs-function\"\u003estd::vector\u0026#x3C;\u003cspan class=\"hljs-type\"\u003euint8_t\u003c/span\u003e\u003e \u003cspan class=\"hljs-title\"\u003egetImage\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(std::string\u0026#x26;)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// 返回对应tag的图片数据\u003c/span\u003e\n    };\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    DB db;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eCachedImage\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Image {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-built_in\"\u003eCachedImage\u003c/span\u003e(DBImage\u0026#x26; dbi) {}\n    \u003cspan class=\"hljs-function\"\u003estd::vector\u0026#x3C;std::string\u003e \u003cspan class=\"hljs-title\"\u003elistImages\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e result = cache.\u003cspan class=\"hljs-built_in\"\u003efindAll\u003c/span\u003e(); \u003cspan class=\"hljs-comment\"\u003e// 缓存查找\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!result.\u003cspan class=\"hljs-built_in\"\u003eempty\u003c/span\u003e()) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result;\n        }\n        result = service.\u003cspan class=\"hljs-built_in\"\u003efindAll\u003c/span\u003e(); \u003cspan class=\"hljs-comment\"\u003e// 原始服务查找\u003c/span\u003e\n        cache.\u003cspan class=\"hljs-built_in\"\u003estore\u003c/span\u003e(result);\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result;\n    };\n    \u003cspan class=\"hljs-function\"\u003estd::vector\u0026#x3C;\u003cspan class=\"hljs-type\"\u003euint8_t\u003c/span\u003e\u003e \u003cspan class=\"hljs-title\"\u003egetImage\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(std::string\u0026#x26; tag)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e img = cache.\u003cspan class=\"hljs-built_in\"\u003efind\u003c/span\u003e(tag); \u003cspan class=\"hljs-comment\"\u003e// 缓存查找图片\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!img.\u003cspan class=\"hljs-built_in\"\u003eempty\u003c/span\u003e()) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e img;\n        }\n        img = service.\u003cspan class=\"hljs-built_in\"\u003efind\u003c/span\u003e(tag); \u003cspan class=\"hljs-comment\"\u003e// 原始服务获取图片\u003c/span\u003e\n        cache.\u003cspan class=\"hljs-built_in\"\u003estore\u003c/span\u003e(tag, img);\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e img;\n    };\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    DBImage service;\n    Cache cache;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e实际使用时，直接调用代理器即可：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-function\"\u003eDBImage \u003cspan class=\"hljs-title\"\u003edbi\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-string\"\u003e\"mongo://xxxx\"\u003c/span\u003e)\u003c/span\u003e\u003c/span\u003e;\n\u003cspan class=\"hljs-function\"\u003eCachedImage \u003cspan class=\"hljs-title\"\u003eci\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(dbi)\u003c/span\u003e\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e result = ci.\u003cspan class=\"hljs-built_in\"\u003elistImages\u003c/span\u003e();\n\u003cspan class=\"hljs-keyword\"\u003eauto\u003c/span\u003e image = ci.\u003cspan class=\"hljs-built_in\"\u003egetImage\u003c/span\u003e(result[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]); \u003cspan class=\"hljs-comment\"\u003e// 第一个tag的图片\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCacheImage\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eCacheImage中使用的Cache，根据实际应用场景，可以是中间件存储，例如：Memcached，redis等。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"mvc模式mvc\"\u003eMVC模式（MVC）\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#mvc模式mvc\"\u003e\u003cspan class=\"anchor-link\"\u003e #\u003c/span\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eMVC分别代表：Model-View-Controller，这种方式应用于程序的分层开发，减少数据，视图界面，和逻辑控制之间的耦合，使开发维护更加清晰。\u003c/p\u003e\n\u003cp\u003e这种模式在传统的MFC开发框架中广泛使用。下面演示一个富文本编辑器的MVC设计。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/post/softwaredesignpattern3/816f2afd2731.png\" alt=\"MVC\"\u003e\u003c/p\u003e\n\u003cp\u003e代码如下：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eModel\u003c/span\u003e {};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eView\u003c/span\u003e {};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eController\u003c/span\u003e {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esetView\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esetModel\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e \u003c/span\u003e= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eDocument\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Model {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-built_in\"\u003eDocument\u003c/span\u003e(Controller* ctrl) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e-\u003ectrl = ctrl;\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    Controller* ctrl;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eRichEditCtrl\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e Controller {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esetView\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(View* v)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e-\u003eview = v;\n    }\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003esetModel\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(Model* m)\u003c/span\u003e \u003c/span\u003e{\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e-\u003emodel = m;\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    View* view;\n    Model* model;\n};\n\n\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eRichEditView\u003c/span\u003e : \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e View {\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e:\n    \u003cspan class=\"hljs-built_in\"\u003eView\u003c/span\u003e(Controller* ctrl) {\n        \u003cspan class=\"hljs-keyword\"\u003ethis\u003c/span\u003e-\u003ectrl = ctrl;\n    }\n\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e:\n    Controller* ctrl;\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e构造MVC时如下：\u003c/p\u003e\n\u003cdiv class=\"code-block-wrapper\"\u003e\u003cdiv class=\"code-block-header\"\u003e\u003cspan class=\"code-block-lang\"\u003ecpp\u003c/span\u003e\u003cbutton class=\"copy-button\" data-copy-state=\"copy\" aria-label=\"Copy code to clipboard\" type=\"button\" onclick=\"copyCode(this)\"\u003e\u003cspan class=\"copy-button-text\"\u003eCopy\u003c/span\u003e\u003c/button\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003eRichEditCtrl ctrl;\n\u003cspan class=\"hljs-function\"\u003eRichEditView \u003cspan class=\"hljs-title\"\u003eview\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u0026#x26;ctrl)\u003c/span\u003e\u003c/span\u003e;\n\u003cspan class=\"hljs-function\"\u003eDocument \u003cspan class=\"hljs-title\"\u003edoc\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u0026#x26;ctrl)\u003c/span\u003e\u003c/span\u003e;\nctrl.\u003cspan class=\"hljs-built_in\"\u003esetView\u003c/span\u003e(\u0026#x26;view);\nctrl.\u003cspan class=\"hljs-built_in\"\u003esetModel\u003c/span\u003e(\u0026#x26;doc);\n\n\u003cspan class=\"hljs-comment\"\u003e// 视图的更新通知控制器\u003c/span\u003e\nctrl.\u003cspan class=\"hljs-built_in\"\u003enotify\u003c/span\u003e();\n\u003cspan class=\"hljs-comment\"\u003e// 控制器更新数据模型\u003c/span\u003e\ndoc.\u003cspan class=\"hljs-built_in\"\u003eupdate\u003c/span\u003e();\n\u003cspan class=\"hljs-comment\"\u003e// 模型更新完后刷新视图\u003c/span\u003e\nview.\u003cspan class=\"hljs-built_in\"\u003erefresh\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"])</script><script>self.__next_f.push([1,"7:[\"$\",\"$L15\",null,{\"postData\":{\"id\":\"softwaredesignpattern3\",\"contentHtml\":\"$16\",\"title\":\"软件设计模式 - 结构型模式\",\"date\":\"$D2017-06-05T21:11:12.000Z\",\"updated\":\"$D2017-06-05T21:11:12.000Z\",\"categories\":[\"总结\"],\"tags\":[\"设计模式\"]}}]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"14:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"软件设计模式 - 结构型模式\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"HCHEN90 博客\"}],[\"$\",\"link\",\"2\",{\"rel\":\"alternate\",\"type\":\"application/atom+xml\",\"href\":\"https://hchen90.top/atom.xml\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]],\"error\":null,\"digest\":\"$undefined\"}\ne:{\"metadata\":\"$14:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>